(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt=Object.prototype.hasOwnProperty,it=function(e,t){function r(){this.constructor=e}for(var n in t){if(rt.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};W=function(e,t){var n,r;r="";for(n=1;n<=e;n+=1){r+="    "}r+=t;return r};z=function(e,t){return W(e,"|-"+t)};U=function(e,t,n){if(!(e!=null))return"";if(typeof e==="string"){return z(t,n+("'"+e+"'\n"))}if(typeof e==="number"){return z(t,n+(""+e+"\n"))}if(typeof e==="boolean"){return z(t,n+(""+e+"\n"))}if(e.getInfo!=null)return e.getInfo(t,n);return z(t,n+"<unknown data type>\n")};D=function(){function e(e){this.url=e.trim().replace(/^#/,"");this.object=null}e.prototype.getInfo=function(e,t){return z(e,t+("<urlLink url='"+this.url+"'>\n"))};return e}();p=function(){function e(e,t){this.url=e;this.scope=t;this.object=null}e.prototype.getInfo=function(e,t){return z(e,t+("<fxLink url='"+this.url+"'>\n"))};return e}();A=function(){function e(e,t){var n,r,i,s,o,u,a,f;this.url=t;this.object=null;this.id=null;this.sids=[];this.member=null;this.indices=null;this.dotSyntax=false;this.arrSyntax=false;u=t.split("/");this.id=u.shift();if(this.id===".")this.id=e;while(u.length>1){this.sids.push(u.shift())}if(u.length>0){o=u[0];i=o.indexOf(".")>=0;r=o.indexOf("(")>=0;if(i){u=o.split(".");this.sids.push(u.shift());this.member=u.shift();this.dotSyntax=true}else if(r){n=o.split("(");this.sids.push(n.shift());this.indices=[];for(a=0,f=n.length;a<f;a++){s=n[a];this.indices.push(parseInt(s.replace(/\)/,""),10))}this.arrSyntax=true}else{this.sids.push(o)}}}e.prototype.getInfo=function(e,t){var n,r;r="<sidLink id='"+this.id+"'";if(this.sids.length>0){r+=", sids='[";r+=this.sids.join(",");r+="]'"}r+=">\n";return n=z(e,t+r)};return e}();t=function(){function e(){this.animTarget={};this.animTarget.channels=[];this.animTarget.activeChannels=[];this.animTarget.dataRows=null;this.animTarget.dataColumns=null}e.prototype.selectAnimation=function(e){var t,n,r,i;this.animTarget.activeChannels=[];i=this.animTarget.channels;for(n=0,r=i.length;n<r;n++){t=i[n];if(e(t,n))this.animTarget.activeChannels.push(t)}};e.prototype.selectAnimationById=function(e){this.selectAnimation(function(t,n){return t.animation.id===e})};e.prototype.selectAnimationByName=function(e){this.selectAnimation(function(t,n){return t.animation.name===e})};e.prototype.selectAllAnimations=function(e){this.selectAnimation(function(e,t){return true})};e.prototype.applyAnimationKeyframe=function(e){throw new Error("applyAnimationKeyframe() not implemented")};e.prototype.initAnimationTarget=function(){throw new Error("initAnimationTarget() not implemented")};e.prototype.resetAnimation=function(){throw new Error("resetAnimation() not implemented")};return e}();n=function(){function e(){this.unit=1;this.upAxis=null}e.prototype.getInfo=function(e,t){return z(e,t+"<asset>\n")};return e}();B=function(){function e(){this.id=null;this.children=[];this.sidChildren=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o;r=z(e,t+("<visualScene id='"+this.id+"'>\n"));if(this.children!=null){o=this.children;for(i=0,s=o.length;i<s;i++){n=o[i];r+=U(n,e+1,"child ")}}return r};return e}();j=function(){function e(){this.id=null;this.sid=null;this.name=null;this.type=null;this.layer=null;this.parent=null;this.children=[];this.sidChildren=[];this.transformations=[];this.geometries=[];this.controllers=[];this.lights=[];this.cameras=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;r=z(e,t+("<visualSceneNode id='"+this.id+"', sid='"+this.sid+"', name='"+this.name+"'>\n"));if(this.geometries!=null){d=this.geometries;for(i=0,a=d.length;i<a;i++){n=d[i];r+=U(n,e+1,"geometry ")}}if(this.controllers!=null){v=this.controllers;for(s=0,f=v.length;s<f;s++){n=v[s];r+=U(n,e+1,"controller ")}}if(this.lights!=null){m=this.lights;for(o=0,l=m.length;o<l;o++){n=m[o];r+=U(n,e+1,"light ")}}if(this.cameras!=null){g=this.cameras;for(u=0,c=g.length;u<c;u++){n=g[u];r+=U(n,e+1,"camera ")}}if(this.children!=null){y=this.children;for(p=0,h=y.length;p<h;p++){n=y[p];r+=U(n,e+1,"child ")}}return r};e.prototype.getTransformMatrix=function(e){var t,n,r,i,s;t=new THREE.Matrix4;e.identity();s=this.transformations;for(r=0,i=s.length;r<i;r++){n=s[r];n.getTransformMatrix(t);e.multiplyMatrices(e,t)}};return e}();k=function(e){function t(){t.__super__.constructor.call(this);this.sid=null;this.type=null;this.data=null;this.originalData=null;this.node=null}it(t,e);t.prototype.getTransformMatrix=function(e){var t;switch(this.type){case"matrix":J(this.data,0,e);break;case"rotate":t=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);e.makeRotationAxis(t,this.data[3]*F);break;case"translate":e.makeTranslation(this.data[0],this.data[1],this.data[2]);break;case"scale":e.makeScale(this.data[0],this.data[1],this.data[2]);break;default:throw new Error("transform type '"+this.type+"' not implemented")}};t.prototype.applyAnimationKeyframe=function(e){var t,n,r,i,s,o,u;o=this.animTarget.activeChannels;for(i=0,s=o.length;i<s;i++){t=o[i];r=t.outputData;for(n=0,u=t.count-1;n<=u;n+=1){this.data[t.offset+n]=r[e*t.stride+n]}}};t.prototype.initAnimationTarget=function(){var e,t,n,r;this.originalData=new Float32Array(this.data.length);r=this.data;for(e=0,n=r.length;e<n;e++){t=r[e];this.originalData[e]=this.data[e]}switch(this.type){case"matrix":this.animTarget.dataColumns=4;this.animTarget.dataRows=4;break;case"rotate":this.animTarget.dataColumns=4;this.animTarget.dataRows=1;break;case"translate":case"scale":this.animTarget.dataColumns=3;this.animTarget.dataRows=1;break;default:throw new Error("transform type '"+this.type+"' not implemented")}};t.prototype.resetAnimation=function(){var e,t,n,r;r=this.originalData;for(e=0,n=r.length;e<n;e++){t=r[e];this.data[e]=this.originalData[e]}};return t}(t);b=function(){function e(){this.geometry=null;this.materials=[];this.sidChildren=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o;r=z(e,t+"<instanceGeometry>\n");r+=U(this.geometry,e+1,"geometry ");o=this.materials;for(i=0,s=o.length;i<s;i++){n=o[i];r+=U(n,e+1,"material ")}return r};return e}();y=function(){function e(){this.controller=null;this.skeletons=[];this.materials=[];this.sidChildren=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o,u,a,f,l;r=z(e,t+"<instanceController>\n");r+=U(this.controller,e+1,"controller ");f=this.skeletons;for(s=0,u=f.length;s<u;s++){i=f[s];r+=U(i,e+1,"skeleton ")}l=this.materials;for(o=0,a=l.length;o<a;o++){n=l[o];r+=U(n,e+1,"material ")}return r};return e}();E=function(){function e(){this.sid=null;this.symbol=null;this.material=null;this.name=null;this.vertexInputs={};this.params={}}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<instanceMaterial sid='"+this.sid+"'>\n"));n+=U(this.material,e+1,"material ");return n};return e}();w=function(){function e(){this.sid=null;this.light=null;this.name=null;this.sidChildren=[]}e.prototype.getInfo=function(e,t){var n;n=z(e,t+"<instanceLight>\n");n+=U(this.light,e+1,"light ");return n};return e}();g=function(){function e(){this.sid=null;this.camera=null;this.name=null;this.sidChildren=[]}e.prototype.getInfo=function(e,t){var n;n=z(e,t+"<instanceCamera>\n");n+=U(this.light,e+1,"camera ");return n};return e}();v=function(){function e(){this.id=null;this.initFrom=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<image id='"+this.id+"'>\n"));n+=U(this.initFrom,e+1,"initFrom ");return n};return e}();a=function(){function e(){this.id=null;this.sids={};this.technique=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<effect id='"+this.id+"'>\n"));n+=U(this.technique,e+1,"technique ");return n};return e}();c=function(){function e(){this.sid=null;this.sids={};this.fxScope=null;this.shading=null;this.emission=null;this.ambient=null;this.diffuse=null;this.specular=null;this.shininess=null;this.reflective=null;this.transparent=null;this.bump=null;this.reflectivity=null;this.transparency=null;this.index_of_refraction=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<technique sid='"+this.sid+"'>\n"));return n};return e}();l=function(){function e(){this.sid=null;this.fxScope=null;this.type=null;this.initFrom=null;this.format=null;this.size=null;this.viewportRatio=null;this.mipLevels=null;this.mipmapGenerate=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<surface sid='"+this.sid+"'>\n"));n+=U(this.initFrom,e+1,"initFrom ");return n};return e}();f=function(){function e(){this.sid=null;this.fxScope=null;this.surface=null;this.image=null;this.wrapS=null;this.wrapT=null;this.minfilter=null;this.magfilter=null;this.borderColor=null;this.mipmapMaxLevel=null;this.mipmapBias=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<sampler sid='"+this.sid+"'>\n"));n+=U(this.image,e+1,"image ");n+=U(this.surface,e+1,"surface ");return n};return e}();o=function(){function e(){this.color=null;this.textureSampler=null;this.texcoord=null;this.opaque=null;this.bumptype=null}return e}();C=function(){function e(){this.id=null;this.name=null;this.effect=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<material id='"+this.id+"' name='"+this.name+"'>\n"));n+=U(this.effect,e+1,"effect ");return n};return e}();d=function(){function e(){this.id=null;this.name=null;this.sources=[];this.vertices=null;this.triangles=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o,u,a,f,l;n=z(e,t+("<geometry id='"+this.id+"' name='"+this.name+"'>\n"));f=this.sources;for(s=0,u=f.length;s<u;s++){r=f[s];n+=U(r,e+1,"source ")}n+=U(this.vertices,e+1,"vertices ");l=this.triangles;for(o=0,a=l.length;o<a;o++){i=l[o];n+=U(i,e+1,"triangles ")}return n};return e}();M=function(){function e(){this.id=null;this.name=null;this.sourceId=null;this.count=null;this.stride=null;this.data=null;this.params={}}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<source id='"+this.id+"' name='"+this.name+"'>\n"));n+=U(this.sourceId,e+1,"sourceId ");return n};return e}();H=function(){function e(){this.id=null;this.name=null;this.inputs=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o;r=z(e,t+("<vertices id='"+this.id+"' name='"+this.name+"'>\n"));o=this.inputs;for(i=0,s=o.length;i<s;i++){n=o[i];r+=U(n,e+1,"input ")}return r};return e}();_=function(){function e(){this.name=null;this.count=null;this.material=null;this.inputs=[];this.indices=null}e.prototype.getInfo=function(e,t){var n,r,i,s,o;r=z(e,t+("<triangles name='"+this.name+"'>\n"));r+=U(this.material,e+1,"material ");o=this.inputs;for(i=0,s=o.length;i<s;i++){n=o[i];r+=U(n,e+1,"input ")}return r};return e}();m=function(){function e(){this.semantic=null;this.source=null;this.offset=null;this.set=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<input semantic="+this.semantic+">\n"));n+=U(this.source,e+1,"source ");return n};return e}();u=function(){function e(){this.id=null;this.name=null;this.skin=null;this.morph=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+("<controller id='"+this.id+"', name='"+this.name+"'>\n"));n+=U(this.skin,e+1,"skin ");n+=U(this.morph,e+1,"morph ");return n};return e}();O=function(){function e(){this.source=null;this.bindShapeMatrix=null;this.sources=[];this.joints=null;this.vertexWeights=null}e.prototype.getInfo=function(e,t){var n,r,i,s,o;n=z(e,t+("<skin source='"+this.source+"'>\n"));n+=U(this.bindShapeMatrix,e+1,"bind_shape_matrix ");o=this.sources;for(i=0,s=o.length;i<s;i++){r=o[i];n+=U(r,e+1,"source ")}n+=U(this.joints,e+1,"joints ");n+=U(this.vertexWeights,e+1,"vertex_weights ");return n};return e}();S=function(){function e(){this.joints=null;this.invBindMatrices=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+"<joints>\n");n+=U(this.joints,e+1,"joints ");n+=U(this.invBindMatrices,e+1,"invBindMatrices ");return n};return e}();P=function(){function e(){this.inputs=[];this.vcount=null;this.v=null;this.joints=null;this.weights=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+"<vertex_weights>\n");n+=U(this.joints,e+1,"joints ");n+=U(this.weights,e+1,"weights ");return n};return e}();e=function(){function e(){this.id=null;this.name=null;this.parent=null;this.rootId=null;this.rootName=null;this.animations=[];this.sources=[];this.samplers=[];this.channels=[]}e.prototype.getInfo=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;i=z(e,t+("<animation id='"+this.id+"', name='"+name+"'>\n"));v=this.animations;for(u=0,c=v.length;u<c;u++){n=v[u];i+=U(n,e+1,"animation ")}m=this.sources;for(a=0,h=m.length;a<h;a++){o=m[a];i+=U(o,e+1,"source ")}g=this.samplers;for(f=0,p=g.length;f<p;f++){s=g[f];i+=U(s,e+1,"sampler ")}y=this.channels;for(l=0,d=y.length;l<d;l++){r=y[l];i+=U(r,e+1,"channel ")}return i};return e}();L=function(){function e(){this.id=null;this.input=null;this.outputs=[];this.inTangents=[];this.outTangents=[];this.interpolation=null}e.prototype.getInfo=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;r=z(e,t+("<sampler id='"+this.id+"'>\n"));r+=U(this.input,e+1,"input ");c=this.outputs;for(s=0,a=c.length;s<a;s++){n=c[s];r+=U(n,e+1,"output ")}h=this.inTangents;for(o=0,f=h.length;o<f;o++){i=h[o];r+=U(i,e+1,"inTangent ")}p=this.outTangents;for(u=0,l=p.length;u<l;u++){i=p[u];r+=U(i,e+1,"outTangent ")}r+=U(this.interpolation,e+1,"interpolation ");return r};return e}();s=function(){function e(){this.animation=null;this.source=null;this.target=null}e.prototype.getInfo=function(e,t){var n;n=z(e,t+"<channel>\n");n+=U(this.source,e+1,"source ");n+=U(this.target,e+1,"target ");return n};return e}();x=function(){function e(){this.id=null;this.name=null;this.type=null;this.color=null;this.params={};this.sidChildren=[]}e.prototype.getInfo=function(e,t){return z(e,t+"<light>\n")};return e}();T=function(){function e(){this.sid=null;this.name=null;this.value=null}return e}();r=function(){function e(){this.id=null;this.name=null;this.type=null;this.params={};this.sidChildren=[]}e.prototype.getInfo=function(e,t){return z(e,t+"<camera>\n")};return e}();i=function(){function e(){this.sid=null;this.name=null;this.value=null}return e}();I=function(){function e(){this.inputData=null;this.outputData=null;this.offset=null;this.stride=null;this.count=null;this.animation=null}return e}();R=function(){function e(){this.index=null;this.node=null;this.sid=null;this.parent=null;this.isAnimated=null;this.matrix=new THREE.Matrix4;this.worldMatrix=new THREE.Matrix4;this.invBindMatrix=new THREE.Matrix4;this.skinMatrix=new THREE.Matrix4;this.worldMatrixDirty=true}e.prototype.getWorldMatrix=function(){if(this.worldMatrixDirty){if(this.parent!=null){this.worldMatrix.multiplyMatrices(this.parent.getWorldMatrix(),this.matrix)}else{this.worldMatrix.copy(this.matrix)}this.worldMatrixDirty=false}return this.worldMatrix};e.prototype.applyAnimation=function(e){var t,n,r,i;if(this.isAnimated){i=this.node.transformations;for(n=0,r=i.length;n<r;n++){t=i[n];t.applyAnimationKeyframe(e)}this.node.getTransformMatrix(this.matrix)}this.worldMatrixDirty=true;return null};e.prototype.updateSkinMatrix=function(e){var t;t=this.getWorldMatrix();this.skinMatrix.multiplyMatrices(t,this.invBindMatrix);this.skinMatrix.multiplyMatrices(this.skinMatrix,e);return null};return e}();q=function(){function e(){this.materials=[];this.indices={};this.needTangents=false}return e}();h=function(){function h(e){var t,n,r;this._url=null;this._baseUrl=null;this._loader=e;this._options={};r=e.options;for(t in r){n=r[t];this._options[t]=n}this._log=e.log;this._readyCallback=null;this._progressCallback=null;this.dae={};this.dae.ids={};this.dae.animationTargets=[];this.dae.libEffects=[];this.dae.libMaterials=[];this.dae.libGeometries=[];this.dae.libControllers=[];this.dae.libLights=[];this.dae.libCameras=[];this.dae.libImages=[];this.dae.libVisualScenes=[];this.dae.libAnimations=[];this.dae.asset=null;this.dae.scene=null;this.threejs={};this.threejs.scene=null;this.threejs.images=[];this.threejs.geometries=[];this.threejs.materials=[];this.scene=null}h.prototype.setUrl=function(e){var t;if(e!=null){this._url=e;t=e.split("/");t.pop();this._baseUrl=(t.length<1?".":t.join("/"))+"/"}else{this._url="";this._baseUrl=""}};h.prototype.getLibInfo=function(e,t,n){var r,i,s,o,u;if(e==null)return"";s=z(t,n+(" <"+n+">\n"));i=0;for(o=0,u=e.length;o<u;o++){r=e[o];s+=U(r,t+1,"");i+=1}if(i>0){return s}else{return""}};h.prototype.getInfo=function(e,t){var n;n="<collada url='"+this.url+"'>\n";n+=U(this.dae.asset,e+1,"asset ");n+=U(this.dae.scene,e+1,"scene ");n+=this.getLibInfo(this.dae.libEffects,e+1,"library_effects");n+=this.getLibInfo(this.dae.libMaterials,e+1,"library_materials");n+=this.getLibInfo(this.dae.libGeometries,e+1,"library_geometries");n+=this.getLibInfo(this.dae.libControllers,e+1,"library_controllers");n+=this.getLibInfo(this.dae.libLights,e+1,"library_lights");n+=this.getLibInfo(this.dae.libCameras,e+1,"library_cameras");n+=this.getLibInfo(this.dae.libImages,e+1,"library_images");n+=this.getLibInfo(this.dae.libVisualScenes,e+1,"library_visual_scenes");n+=this.getLibInfo(this.dae.libAnimations,e+1,"library_animations");return n};h.prototype._reportUnexpectedChild=function(e,t){this._log("Skipped unknown <"+e.nodeName+"> child <"+t.nodeName+">.",N.messageWarning)};h.prototype._reportUnhandledExtra=function(e,t){this._log("Skipped element <"+e.nodeName+">/<"+t.nodeName+">. Element is legal, but not handled by this loader.",N.messageWarning)};h.prototype._getAttributeAsFloat=function(e,t,n){var r;r=e.getAttribute(t);if(r!=null){return parseFloat(r)}else{return n}};h.prototype._getAttributeAsInt=function(e,t,n){var r;r=e.getAttribute(t);if(r!=null){return parseInt(r,10)}else{return n}};h.prototype._addUrlTarget=function(e,t,n){var r;if(t!=null)t.push(e);r=e.id;if(!(r!=null)){if(n)this._log("Object has no ID.",N.messageError);return}if(this.dae.ids[r]!=null){this._log("There is already an object with ID "+r+".",N.messageError);return}this.dae.ids[r]=e};h.prototype._resolveUrlLink=function(e){e.object=this.dae.ids[e.url];if(!(e.object!=null)){this._log("Could not resolve URL #"+e.url,N.messageError);return false}return true};h.prototype._addFxTarget=function(e,t){var n;n=e.sid;if(!(n!=null)){this._log("Cannot add a FX target: object has no SID.",N.messageError);return}if(t.sids[n]!=null){this._log("There is already an FX target with SID "+n+".",N.messageError);return}e.fxScope=t;t.sids[n]=e};h.prototype._resolveFxLink=function(e){var t;t=e.scope;while(!(e.object!=null)&&t!=null){e.object=t.sids[e.url];t=t.fxScope}if(!(e.object!=null)){this._log("Could not resolve FX parameter #"+e.url,N.messageError);return false}return true};h.prototype._addSidTarget=function(e,t){if(!(t.sidChildren!=null))t.sidChildren=[];t.sidChildren.push(e)};h.prototype._findSidTarget=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;a=t.split("/");i=e;n=null;for(f=0,c=a.length;f<c;f++){o=a[f];s=[i];while(s.length!==0){r=s.shift();if(r.sid===o){n=r;break}if(r.sidChildren!=null){p=r.sidChildren;for(l=0,h=p.length;l<h;l++){u=p[l];s.push(u)}}}if(!(n!=null))return null;i=n}return n};h.prototype._resolveSidLink=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;t=this.dae.ids[e.id];if(!(t!=null)){this._log("Could not resolve SID #"+e.url+", missing base ID "+e.id,N.messageError);return false}i=t;n=null;h=e.sids;for(a=0,l=h.length;a<l;a++){o=h[a];s=[i];while(s.length!==0){r=s.shift();if(r.sid===o){n=r;break}if(r.sidChildren!=null){p=r.sidChildren;for(f=0,c=p.length;f<c;f++){u=p[f];s.push(u)}}}if(!(n!=null)){this._log("Could not resolve SID #"+e.url+", missing SID part "+o,N.messageError);return false}i=n}e.object=n;return true};h.prototype._getLinkTarget=function(e,t){if(!(e!=null))return null;if(!(e.object!=null)){if(e instanceof D){this._resolveUrlLink(e)}else if(e instanceof A){this._resolveSidLink(e)}else if(e instanceof p){this._resolveFxLink(e)}else{this._log("Trying to resolve an object that is not a link",N.messageError)}}if(t!=null&&e.object!=null&&!(e.object instanceof t)){this._log("Link "+e.url+" does not link to a "+t.name,N.messageError)}return e.object};h.prototype._parseXml=function(e){var t,n;t=e.childNodes[0];if((t!=null?(n=t.nodeName)!=null?n.toUpperCase():void 0:void 0)==="COLLADA"){this._parseCollada(t)}else{this._log("Can not parse document, top level element is not <COLLADA>.",N.messageError)}};h.prototype._parseCollada=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"asset":this._parseAsset(t);break;case"scene":this._parseScene(t);break;case"library_effects":this._parseLibEffect(t);break;case"library_materials":this._parseLibMaterial(t);break;case"library_geometries":this._parseLibGeometry(t);break;case"library_images":this._parseLibImage(t);break;case"library_visual_scenes":this._parseLibVisualScene(t);break;case"library_controllers":this._parseLibController(t);break;case"library_animations":this._parseLibAnimation(t);break;case"library_lights":this._parseLibLight(t);break;case"library_cameras":this._parseLibCamera(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseAsset=function(e){var t,r,i,s;if(!this.dae.asset)this.dae.asset=new n;s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"unit":this.dae.asset.unit=this._getAttributeAsFloat(t,"meter");break;case"up_axis":this.dae.asset.upAxis=t.textContent.toUpperCase().charAt(0);break;case"contributor":case"created":case"modified":case"revision":case"title":case"subject":case"keywords":break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseScene=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"instance_visual_scene":this.dae.scene=new D(t.getAttribute("url"));break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseLibVisualScene=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"visual_scene":this._parseVisualScene(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseVisualScene=function(e){var t,n,r,i,s;n=new B;n.id=e.getAttribute("id");this._addUrlTarget(n,this.dae.libVisualScenes,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"node":this._parseSceneNode(n,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseSceneNode=function(e,t){var n,r,i,s,o;r=new j;r.id=t.getAttribute("id");r.sid=t.getAttribute("sid");r.name=t.getAttribute("name");r.type=t.getAttribute("type");r.layer=t.getAttribute("layer");r.parent=e;e.children.push(r);this._addUrlTarget(r,null,false);this._addSidTarget(r,e);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"instance_geometry":this._parseInstanceGeometry(r,n);break;case"instance_controller":this._parseInstanceController(r,n);break;case"instance_light":this._parseInstanceLight(r,n);break;case"instance_camera":this._parseInstanceCamera(r,n);break;case"matrix":case"rotate":case"translate":case"scale":this._parseTransformElement(r,n);break;case"node":this._parseSceneNode(r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseInstanceGeometry=function(e,t){var n,r,i,s,o;r=new b;r.geometry=new D(t.getAttribute("url"));r.sid=t.getAttribute("sid");e.geometries.push(r);this._addSidTarget(r,e);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"bind_material":this._parseBindMaterial(r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseInstanceController=function(e,t){var n,r,i,s,o;r=new y;r.controller=new D(t.getAttribute("url"));r.sid=t.getAttribute("sid");r.name=t.getAttribute("name");e.controllers.push(r);this._addSidTarget(r,e);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"skeleton":r.skeletons.push(new D(n.textContent));break;case"bind_material":this._parseBindMaterial(r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseBindMaterial=function(e,t){var n,r,i,s;s=t.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"technique_common":this._parseBindMaterialTechnique(e,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseBindMaterialTechnique=function(e,t){var n,r,i,s;s=t.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"instance_material":this._parseInstanceMaterial(e,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseInstanceMaterial=function(e,t){var n,r,i,s,o,u,a,f,l;s=new E;s.symbol=t.getAttribute("symbol");s.material=new D(t.getAttribute("target"));e.materials.push(s);this._addSidTarget(s,e);l=t.childNodes;for(a=0,f=l.length;a<f;a++){n=l[a];if(n.nodeType===1){switch(n.nodeName){case"bind_vertex_input":o=n.getAttribute("semantic");r=n.getAttribute("input_semantic");i=n.getAttribute("input_set");if(i!=null)i=parseInt(i,10);s.vertexInputs[o]={inputSemantic:r,inputSet:i};break;case"bind":o=n.getAttribute("semantic");u=new A(null,n.getAttribute("target"));s.params[o]={target:u};break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseTransformElement=function(e,t){var n,r;r=new k;r.sid=t.getAttribute("sid");r.type=t.nodeName;r.node=e;e.transformations.push(r);this._addSidTarget(r,e);this.dae.animationTargets.push(r);r.data=et(t.textContent);n=0;switch(r.type){case"matrix":n=16;break;case"rotate":n=4;break;case"translate":n=3;break;case"scale":n=3;break;case"skew":n=7;break;case"lookat":n=9;break;default:this._log("Unknown transformation type "+r.type+".",N.messageError)}if(r.data.length!==n){this._log("Wrong number of elements for transformation type '"+r.type+"': expected "+n+", found "+r.data.length,N.messageError)}};h.prototype._parseInstanceLight=function(e,t){var n,r,i,s,o;r=new w;r.light=new D(t.getAttribute("url"));r.sid=t.getAttribute("sid");r.name=t.getAttribute("name");e.lights.push(r);this._addSidTarget(r,e);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"extra":this._reportUnhandledExtra(t,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseInstanceCamera=function(e,t){var n,r,i,s,o;n=new g;n.camera=new D(t.getAttribute("url"));n.sid=t.getAttribute("sid");n.name=t.getAttribute("name");e.cameras.push(n);this._addSidTarget(n,e);o=t.childNodes;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.nodeType===1){switch(r.nodeName){case"extra":this._reportUnhandledExtra(t,r);break;default:this._reportUnexpectedChild(t,r)}}}};h.prototype._parseLibEffect=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"effect":this._parseEffect(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseEffect=function(e){var t,n,r,i,s;n=new a;n.id=e.getAttribute("id");this._addUrlTarget(n,this.dae.libEffects,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"profile_COMMON":this._parseEffectProfileCommon(n,t);break;case"profile":this._log("Skipped non-common effect profile for effect "+n.id+".",N.messageWarning);break;case"extra":break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseEffectProfileCommon=function(e,t){var n,r,i,s;s=t.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"newparam":this._parseEffectNewparam(e,n);break;case"technique":this._parseEffectTechnique(e,n);break;case"extra":this._parseTechniqueExtra(e.technique,"COMMON",n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseEffectNewparam=function(e,t){var n,r,i,s,o;r=t.getAttribute("sid");o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"surface":this._parseEffectSurface(e,r,n);break;case"sampler2D":this._parseEffectSampler(e,r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseEffectSurface=function(e,t,n){var r,i,s,o,u;i=new l;i.type=n.getAttribute("type");i.sid=t;this._addFxTarget(i,e);u=n.childNodes;for(s=0,o=u.length;s<o;s++){r=u[s];if(r.nodeType===1){switch(r.nodeName){case"init_from":i.initFrom=new D(r.textContent);break;case"format":i.format=r.textContent;break;case"size":i.size=et(r.textContent);break;case"viewport_ratio":i.viewportRatio=et(r.textContent);break;case"mip_levels":i.mipLevels=parseInt(r.textContent,10);break;case"mipmap_generate":i.mipmapGenerate=r.textContent;break;default:this._reportUnexpectedChild(n,r)}}}};h.prototype._parseEffectSampler=function(e,t,n){var r,i,s,o,u;i=new f;i.sid=t;this._addFxTarget(i,e);u=n.childNodes;for(s=0,o=u.length;s<o;s++){r=u[s];if(r.nodeType===1){switch(r.nodeName){case"source":i.surface=new p(r.textContent,e);break;case"instance_image":i.image=new D(r.getAttribute("url"));break;case"wrap_s":i.wrapS=r.textContent;break;case"wrap_t":i.wrapT=r.textContent;break;case"minfilter":i.minfilter=r.textContent;break;case"magfilter":i.magfilter=r.textContent;break;case"border_color":i.borderColor=et(r.textContent);break;case"mipmap_maxlevel":i.mipmapMaxLevel=parseInt(r.textContent,10);break;case"mipmap_bias":i.mipmapBias=parseFloat(r.textContent);break;default:this._reportUnexpectedChild(n,r)}}}};h.prototype._parseEffectTechnique=function(e,t){var n,r,i,s,o;r=new c;r.sid=t.getAttribute("sid");this._addFxTarget(r,e);e.technique=r;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"blinn":case"phong":case"lambert":case"constant":r.shading=n.nodeName;this._parseTechniqueParam(r,"COMMON",n);break;case"extra":this._parseTechniqueExtra(r,"COMMON",n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseTechniqueParam=function(e,t,n){var r,i,s,o;o=n.childNodes;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.nodeType===1){switch(r.nodeName){case"newparam":this._parseEffectNewparam(e,r);break;case"emission":case"ambient":case"diffuse":case"specular":case"reflective":this._parseEffectColorOrTexture(e,r);break;case"shininess":case"reflectivity":case"transparency":case"index_of_refraction":e[r.nodeName]=parseFloat(r.childNodes[1].textContent);break;case"transparent":this._parseEffectColorOrTexture(e,r);e.transparent.opaque=r.getAttribute("opaque");break;case"bump":this._parseEffectColorOrTexture(e,r);e.bump.bumptype=r.getAttribute("bumptype");break;case"double_sided":e.doubleSided=parseInt(r.textContent,10)===1?true:false;break;default:if(t==="COMMON")this._reportUnexpectedChild(n,r)}}}};h.prototype._parseTechniqueExtra=function(e,t,n){var r,i,s,o;o=n.childNodes;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.nodeType===1){switch(r.nodeName){case"technique":t=r.getAttribute("profile");this._parseTechniqueParam(e,t,r);break;default:this._reportUnexpectedChild(n,r)}}}};h.prototype._parseEffectColorOrTexture=function(e,t){var n,r,i,s,u,a,f;i=t.nodeName;r=e[i];if(!(r!=null)){r=new o;e[i]=r}f=t.childNodes;for(u=0,a=f.length;u<a;u++){n=f[u];if(n.nodeType===1){switch(n.nodeName){case"color":r.color=Z(n.textContent);break;case"texture":s=n.getAttribute("texture");r.textureSampler=new p(s,e);r.texcoord=n.getAttribute("texcoord");break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseLibMaterial=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"material":this._parseMaterial(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseMaterial=function(e){var t,n,r,i,s;n=new C;n.id=e.getAttribute("id");n.name=e.getAttribute("name");this._addUrlTarget(n,this.dae.libMaterials,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"instance_effect":n.effect=new D(t.getAttribute("url"));break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseLibGeometry=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"geometry":this._parseGeometry(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseGeometry=function(e){var t,n,r,i,s;n=new d;n.id=e.getAttribute("id");n.name=e.getAttribute("name");this._addUrlTarget(n,this.dae.libGeometries,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"mesh":this._parseMesh(n,t);break;case"convex_mesh":case"spline":this._log("Geometry type "+t.nodeName+" not supported.",N.messageError);break;case"extra":this._parseGeometryExtra(n,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseMesh=function(e,t){var n,r,i,s;s=t.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"source":this._parseSource(e,n);break;case"vertices":this._parseVertices(e,n);break;case"triangles":case"polylist":case"polygons":this._parseTriangles(e,n);break;case"lines":case"linestrips":case"trifans":case"tristrips":this._log("Geometry primitive type "+n.nodeName+" not supported.",N.messageError);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseGeometryExtra=function(e,t){var n,r,i,s,o;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"technique":r=n.getAttribute("profile");this._parseGeometryExtraTechnique(e,r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseGeometryExtraTechnique=function(e,t,n){var r,i,s,o;o=n.childNodes;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.nodeType===1){switch(r.nodeName){case"double_sided":e.doubleSided=n.textContent==="1"}}}};h.prototype._parseSource=function(e,t){var n,r,i,s,o;r=new M;r.id=t.getAttribute("id");r.name=t.getAttribute("name");this._addUrlTarget(r,e.sources,true);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"bool_array":r.sourceId=n.getAttribute("id");r.data=Y(n.textContent);break;case"float_array":r.sourceId=n.getAttribute("id");r.data=et(n.textContent);break;case"int_array":r.sourceId=n.getAttribute("id");r.data=tt(n.textContent);break;case"IDREF_array":case"Name_array":r.sourceId=n.getAttribute("id");r.data=nt(n.textContent);break;case"technique_common":this._parseSourceTechniqueCommon(r,n);break;case"technique":break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseVertices=function(e,t){var n,r,i,s,o;r=new H;r.id=t.getAttribute("id");r.name=t.getAttribute("name");this._addUrlTarget(r,null,true);e.vertices=r;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"input":r.inputs.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseTriangles=function(e,t){var n,r,i,s,o;r=new _;r.name=t.getAttribute("name");r.material=t.getAttribute("material");r.count=this._getAttributeAsInt(t,"count");r.type=t.nodeName;e.triangles.push(r);o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"input":r.inputs.push(this._parseInput(n));break;case"vcount":r.vcount=tt(n.textContent);break;case"p":r.indices=tt(n.textContent);break;default:this._reportUnexpectedChild(t,n)}}}return r};h.prototype._parseSourceTechniqueCommon=function(e,t){var n,r,i,s;s=t.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"accessor":this._parseAccessor(e,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseAccessor=function(e,t){var n,r,i,s,o,u,a;i=t.getAttribute("source");e.count=t.getAttribute("count");e.stride=this._getAttributeAsInt(t,"stride",1);if(i!=="#"+e.sourceId){this._log("Non-local sources not supported, source data will be empty",N.messageError)}a=t.childNodes;for(o=0,u=a.length;o<u;o++){n=a[o];if(n.nodeType===1){switch(n.nodeName){case"param":r=n.getAttribute("name");s=n.getAttribute("type");e.params[r]=s;break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseInput=function(e){var t;t=new m;t.semantic=e.getAttribute("semantic");t.source=new D(e.getAttribute("source"));t.offset=this._getAttributeAsInt(e,"offset");t.set=this._getAttributeAsInt(e,"set");return t};h.prototype._parseLibImage=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"image":this._parseImage(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseImage=function(e){var t,n,r,i,s;n=new v;n.id=e.getAttribute("id");this._addUrlTarget(n,this.dae.libImages,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"init_from":n.initFrom=t.textContent;break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseLibController=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"controller":this._parseController(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseController=function(e){var t,n,r,i,s;n=new u;n.id=e.getAttribute("id");n.name=e.getAttribute("name");this._addUrlTarget(n,this.dae.libControllers,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"skin":this._parseSkin(n,t);break;case"morph":this._parseMorph(n,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseMorph=function(e,t){this._log("Morph controllers not implemented",N.messageError)};h.prototype._parseSkin=function(e,t){var n,r,i,s,o;r=new O;r.source=new D(t.getAttribute("source"));if(e.skin!=null||e.morph!=null){this._log("Controller already has a skin or morph",N.messageError)}e.skin=r;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"bind_shape_matrix":this._parseBindShapeMatrix(r,n);break;case"source":this._parseSource(r,n);break;case"joints":this._parseJoints(r,n);break;case"vertex_weights":this._parseVertexWeights(r,n);break;default:this._reportUnexpectedChild(t,n)}}}};h.prototype._parseBindShapeMatrix=function(e,t){e.bindShapeMatrix=et(t.textContent)};h.prototype._parseJoints=function(e,t){var n,r,i,s,o,u,a,f,l;s=new S;if(e.joints!=null){this._log("Skin already has a joints array",N.messageError)}e.joints=s;i=[];l=t.childNodes;for(o=0,a=l.length;o<a;o++){n=l[o];if(n.nodeType===1){switch(n.nodeName){case"input":i.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}}}for(u=0,f=i.length;u<f;u++){r=i[u];switch(r.semantic){case"JOINT":s.joints=r;break;case"INV_BIND_MATRIX":s.invBindMatrices=r;break;default:this._log("Unknown joints input semantic "+r.semantic,N.messageError)}}};h.prototype._parseVertexWeights=function(e,t){var n,r,i,s,o,u,a,f,l;s=new P;s.count=parseInt(t.getAttribute("count"),10);if(e.vertexWeights!=null){this._log("Skin already has a vertex weight array",N.messageError)}e.vertexWeights=s;i=[];l=t.childNodes;for(o=0,a=l.length;o<a;o++){n=l[o];if(n.nodeType===1){switch(n.nodeName){case"input":i.push(this._parseInput(n));break;case"vcount":s.vcount=tt(n.textContent);break;case"v":s.v=tt(n.textContent);break;default:this._reportUnexpectedChild(t,n)}}}for(u=0,f=i.length;u<f;u++){r=i[u];switch(r.semantic){case"JOINT":s.joints=r;break;case"WEIGHT":s.weights=r;break;default:this._log("Unknown vertex weight input semantic "+r.semantic,N.messageError)}}};h.prototype._parseLibAnimation=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"animation":this._parseAnimation(null,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseAnimation=function(t,n){var r,i,s,o,u;r=new e;r.id=n.getAttribute("id");r.name=n.getAttribute("name");r.parent=t;if(t!=null){r.rootId=t.rootId;r.rootName=t.rootName}else{r.rootId=r.id;r.rootName=r.name}this._addUrlTarget(r,(t!=null?t.animations:void 0)||this.dae.libAnimations,false);u=n.childNodes;for(s=0,o=u.length;s<o;s++){i=u[s];if(i.nodeType===1){switch(i.nodeName){case"animation":this._parseAnimation(r,i);break;case"source":this._parseSource(r,i);break;case"sampler":this._parseSampler(r,i);break;case"channel":this._parseChannel(r,i);break;default:this._reportUnexpectedChild(n,i)}}}};h.prototype._parseSampler=function(e,t){var n,r,i,s,o,u,a,f,l;s=new L;s.id=t.getAttribute("id");if(s.id!=null)this._addUrlTarget(s,e.samplers,false);i=[];l=t.childNodes;for(o=0,a=l.length;o<a;o++){n=l[o];if(n.nodeType===1){switch(n.nodeName){case"input":i.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}}}for(u=0,f=i.length;u<f;u++){r=i[u];switch(r.semantic){case"INPUT":s.input=r;break;case"OUTPUT":s.outputs.push(r);break;case"INTERPOLATION":s.interpolation=r;break;case"IN_TANGENT":s.inTangents.push(r);break;case"OUT_TANGENT":s.outTangents.push(r);break;default:this._log("Unknown sampler input semantic "+r.semantic,N.messageError)}}};h.prototype._parseChannel=function(e,t){var n,r,i,o,u;n=new s;n.source=new D(t.getAttribute("source"));n.target=new A(e.id,t.getAttribute("target"));e.channels.push(n);n.animation=e;u=t.childNodes;for(i=0,o=u.length;i<o;i++){r=u[i];if(r.nodeType===1)this._reportUnexpectedChild(t,r)}};h.prototype._parseLibLight=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"light":this._parseLight(t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseLight=function(e){var t,n,r,i,s;n=new x;n.id=e.getAttribute("id");n.name=e.getAttribute("name");if(n.id!=null)this._addUrlTarget(n,this.dae.libLights,true);s=e.childNodes;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.nodeType===1){switch(t.nodeName){case"technique_common":this._parseLightTechniqueCommon(t,n);break;case"extra":this._reportUnhandledExtra(e,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseLightTechniqueCommon=function(e,t){var n,r,i,s;s=e.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"ambient":this._parseLightParams(n,"COMMON",t);break;case"directional":this._parseLightParams(n,"COMMON",t);break;case"point":this._parseLightParams(n,"COMMON",t);break;case"spot":this._parseLightParams(n,"COMMON",t);break;default:this._reportUnexpectedChild(e,n)}}}};h.prototype._parseLightParams=function(e,t,n){var r,i,s,o;n.type=e.nodeName;o=e.childNodes;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.nodeType===1){switch(r.nodeName){case"color":this._parseLightColor(r,t,n);break;case"constant_attenuation":this._parseLightParam(r,t,n);break;case"linear_attenuation":this._parseLightParam(r,t,n);break;case"quadratic_attenuation":this._parseLightParam(r,t,n);break;case"falloff_angle":this._parseLightParam(r,t,n);break;case"falloff_exponent":this._parseLightParam(r,t,n);break;default:this._reportUnexpectedChild(e,r)}}}};h.prototype._parseLightColor=function(e,t,n){n.color=et(e.textContent)};h.prototype._parseLightParam=function(e,t,n){var r;r=new T;r.sid=e.getAttribute("sid");r.name=e.nodeName;n.params[r.name]=r;this._addSidTarget(r,n);r.value=parseFloat(e.textContent)};h.prototype._parseLibCamera=function(e){var t,n,r,i;i=e.childNodes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.nodeType===1){switch(t.nodeName){case"camera":this._parseCamera(t);break;case"extra":this._reportUnhandledExtra(e,t);break;default:this._reportUnexpectedChild(e,t)}}}};h.prototype._parseCamera=function(e){var t,n,i,s,o;t=new r;t.id=e.getAttribute("id");if(t.id!=null)this._addUrlTarget(t,this.dae.libCameras,true);t.name=e.getAttribute("name");o=e.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.nodeType===1){switch(n.nodeName){case"asset":this._reportUnhandledExtra(e,n);break;case"optics":this._parseCameraOptics(n,t);break;case"imager":this._reportUnhandledExtra(e,n);break;case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}}}};h.prototype._parseCameraOptics=function(e,t){var n,r,i,s;s=e.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"technique_common":this._parseCameraTechniqueCommon(n,t);break;case"technique":this._reportUnhandledExtra(e,n);break;case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}}}};h.prototype._parseCameraTechniqueCommon=function(e,t){var n,r,i,s;s=e.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"orthographic":this._parseCameraParams(n,t);break;case"perspective":this._parseCameraParams(n,t);break;default:this._reportUnexpectedChild(e,n)}}}};h.prototype._parseCameraParams=function(e,t){var n,r,i,s;t.type=e.nodeName;s=e.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1){switch(n.nodeName){case"xmag":this._parseCameraParam(n,t);break;case"ymag":this._parseCameraParam(n,t);break;case"xfov":this._parseCameraParam(n,t);break;case"yfov":this._parseCameraParam(n,t);break;case"aspect_ratio":this._parseCameraParam(n,t);break;case"znear":this._parseCameraParam(n,t);break;case"zfar":this._parseCameraParam(n,t);break;case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}}}};h.prototype._parseCameraParam=function(e,t){var n;n=new i;n.sid=e.getAttribute("sid");n.name=e.nodeName;t.params[n.name]=n;this._addSidTarget(n,t);n.value=parseFloat(e.textContent)};h.prototype._linkAnimations=function(){var e,t,n,r,i,s,o,u;o=this.dae.animationTargets;for(n=0,i=o.length;n<i;n++){t=o[n];t.initAnimationTarget()}u=this.dae.libAnimations;for(r=0,s=u.length;r<s;r++){e=u[r];this._linkAnimationChannels(e)}};h.prototype._linkAnimationChannels=function(e){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;d=e.channels;for(l=0,h=d.length;l<h;l++){n=d[l];a=this._getLinkTarget(n.target,t);if(!(a!=null)){this._log("Animation channel has an invalid target '"+n.target.url+"', animation ignored",N.messageWarning);continue}u=this._getLinkTarget(n.source,L);if(!(u!=null)){this._log("Animation channel has an invalid sampler '"+n.source.url+"', animation ignored",N.messageWarning);continue}i=this._getLinkTarget((v=u.input)!=null?v.source:void 0);if(!(i!=null)){this._log("Animation channel has no input data, animation ignored",N.messageWarning);continue}if(u.outputs.length===0){this._log("Animation channel has no output, animation ignored",N.messageWarning);continue}if(u.outputs.length>1){this._log("Animation channel has more than one output, using only the first output",N.messageWarning)}s=u.outputs[0];o=this._getLinkTarget(s!=null?s.source:void 0);if(!(o!=null)){this._log("Animation channel has no output data, animation ignored",N.messageWarning);continue}f=new I;f.outputData=o.data;f.inputData=i.data;f.stride=o.stride;f.animation=e;if(n.target.dotSyntax){f.semantic=n.target.member;f.count=1;switch(f.semantic){case"X":f.offset=0;break;case"Y":f.offset=1;break;case"Z":f.offset=2;break;case"W":f.offset=3;break;case"R":f.offset=0;break;case"G":f.offset=1;break;case"B":f.offset=2;break;case"U":f.offset=0;break;case"V":f.offset=1;break;case"S":f.offset=0;break;case"T":f.offset=1;break;case"P":f.offset=2;break;case"Q":f.offset=3;break;case"ANGLE":f.offset=3;break;default:this._log("Unknown semantic for '"+targetLink.url+"', animation ignored",N.messageWarning);continue}}else if(n.target.arrSyntax){switch(targetLink.indices.length){case 1:f.offset=targetLink.indices[0];break;case 2:f.offset=targetLink.indices[0]*a.animTarget.dataRows+targetLink.indices[1];break;default:this._log("Invalid number of indices for '"+targetLink.url+"', animation ignored",N.messageWarning);continue}f.count=1}else{f.offset=0;f.count=a.animTarget.dataColumns*a.animTarget.dataRows}a.animTarget.channels.push(f)}m=e.animations;for(c=0,p=m.length;c<p;c++){r=m[c];this._linkAnimationChannels(r)}};h.prototype._createSceneGraph=function(){var e,t,n,r,i,s;t=this._getLinkTarget(this.dae.scene,B);if(!(t!=null))return;n=new THREE.Object3D;this.threejs.scene=n;s=t.children;for(r=0,i=s.length;r<i;r++){e=s[r];this._createSceneGraphNode(e,n)}this.scene=n};h.prototype._setNodeTransformation=function(e,t){e.getTransformMatrix(t.matrix);t.matrix.decompose(t.position,t.quaternion,t.scale);t.rotation.setFromQuaternion(t.quaternion)};h.prototype._createSceneGraphNode=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,C,k,L,A,O;f=[];C=e.geometries;for(p=0,g=C.length;p<g;p++){s=C[p];c=this._createStaticMesh(s);if(c!=null){c.name=e.name!=null?e.name:"";f.push(c)}}k=e.controllers;for(d=0,y=k.length;d<y;d++){i=k[d];c=this._createAnimatedMesh(i);if(c!=null){c.name=e.name!=null?e.name:"";f.push(c)}}L=e.lights;for(v=0,b=L.length;v<b;v++){o=L[v];l=this._createLight(o);if(l!=null){l.name=e.name!=null?e.name:"";f.push(l)}}A=e.cameras;for(m=0,w=A.length;m<w;m++){n=A[m];u=this._createCamera(n);if(u!=null){u.name=e.name!=null?e.name:"";f.push(u)}}if(f.length>1){h=new THREE.Object3D;for(x=0,E=f.length;x<E;x++){a=f[x];if(a!=null)h.add(a)}t.add(h)}else if(f.length===1){h=f[0];t.add(h)}else if(f.length===0){if(e.type!=="JOINT"){this._log("Collada node "+e.name+" did not produce any threejs nodes",N.messageWarning)}h=new THREE.Object3D;t.add(h)}this._setNodeTransformation(e,h);O=e.children;for(T=0,S=O.length;T<S;T++){r=O[T];this._createSceneGraphNode(r,h)}};h.prototype._createLight=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;a=this._getLinkTarget(e.light,x);if(!(a!=null)){this._log("Light instance has no light, light ignored",N.messageWarning);return null}i=a.color;s=i[0]*255<<16^i[1]*255<<8^i[2]*255<<0;t=(f=a.params["constant_attenuation"])!=null?f.value:void 0;n=(l=a.params["linear_attenuation"])!=null?l.value:void 0;r=(c=a.params["quadratic_attenuation"])!=null?c.value:void 0;o=(h=a.params["falloff_angle"])!=null?h.value:void 0;u=(p=a.params["falloff_exponent"])!=null?p.value:void 0;switch(a.type){case"ambient":a=new THREE.AmbientLight(s);break;case"directional":a=new THREE.DirectionalLight(s,1);break;case"point":a=new THREE.PointLight(s,t,n);break;case"spot":a=new THREE.SpotLight(s,t,n,o,u);break;default:this._log("Unknown light type "+e.type+", light ignored.",N.messageError)}return a};h.prototype._createCamera=function(e){var t,n,i,s,o,u,a,f,l,c,h,p,d,v,m;n=this._getLinkTarget(e.camera,r);if(!(n!=null)){this._log("Camera instance has no camera, camera ignored",N.messageWarning);return null}s=(l=n.params["xmag"])!=null?l.value:void 0;u=(c=n.params["ymag"])!=null?c.value:void 0;i=(h=n.params["xfov"])!=null?h.value:void 0;o=(p=n.params["yfov"])!=null?p.value:void 0;t=(d=n.params["aspect_ratio"])!=null?d.value:void 0;f=(v=n.params["znear"])!=null?v.value:void 0;a=(m=n.params["zfar"])!=null?m.value:void 0;switch(n.type){case"orthographic":if(s!=null&&u!=null){t=s/u}else if(u!=null&&t!=null){s=u*t}else if(s!=null&&t!=null){u=s/t}else if(s!=null){t=1;u=s}else if(u!=null){t=1;s=u}else{this._log("Not enough field of view parameters for an orthographic camera.",N.messageError)}n=new THREE.OrthographicCamera(-s,+s,-u,+u,f,a);break;case"perspective":if(i!=null&&o!=null){t=i/o}else if(o!=null&&t!=null){i=o*t}else if(i!=null&&t!=null){o=i/t}else if(i!=null){t=1;o=i}else if(o!=null){t=1;i=o}else{this._log("Not enough field of view parameters for a perspective camera.",N.messageError)}n=new THREE.PerspectiveCamera(o,t,f,a);break;default:this._log("Unknown camera type "+e.type+", camera ignored.",N.messageError)}return n};h.prototype._createStaticMesh=function(e){var t,n,r,i,s;t=this._getLinkTarget(e.geometry,d);if(!(t!=null)){this._log("Geometry instance has no geometry, mesh ignored",N.messageWarning);return null}s=this._createGeometryAndMaterial(t,e.materials),r=s[0],i=s[1];n=new THREE.Mesh(r,i);return n};h.prototype._createGeometryAndMaterial=function(e,t){var n,r,i,s,o,u,a;s=this._createMaterials(t);r=this._createGeometry(e,s);i=null;if(s.materials.length>1){i=new THREE.MeshFaceMaterial;a=s.materials;for(o=0,u=a.length;o<u;o++){n=a[o];i.materials.push(n)}}else{i=s.materials[0]}return[r,i]};h.prototype._createAnimatedMesh=function(e,t){t=this._getLinkTarget(e.controller,u);if(t.skin!=null){return this._createSkinMesh(e,t)}if(t.morph!=null){return this._createMorphMesh(e,t)}this._log("Controller has neither a skin nor a morph, can not create a mesh",N.messageError);return null};h.prototype._createSkinMesh=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,C,k,L,A,_,D,P,H;o=t.skin;if(!(o!=null)||!(o instanceof O)){this._log("Controller for a skinned mesh has no skin, mesh ignored",N.messageError);return null}u=this._getLinkTarget(o.source);if(!(u!=null)){this._log("Skin for a skinned mesh has no geometry, mesh ignored",N.messageError);return null}if(!this._options["useAnimations"]){k=this._createGeometryAndMaterial(u,e.materials),m=k[0],g=k[1];return new THREE.Mesh(m,g)}v=[];L=e.skeletons;for(y=0,S=L.length;y<S;y++){d=L[y];p=this._getLinkTarget(d,j);if(!(p!=null)){this._log("Controller instance for a skinned mesh uses unknown skeleton "+p+", skeleton ignored",N.messageError);continue}v.push(p)}if(v.length===0){this._log("Controller instance for a skinned mesh has no skeleton, mesh ignored",N.messageError);return null}if(!(o.joints!=null)){this._log("Skin has no joints, mesh ignored",N.messageError);return null}s=this._getLinkTarget((A=o.joints.joints)!=null?A.source:void 0,M);if(!(s!=null)||!(s.data!=null)){this._log("Skin has no joints source, mesh ignored",N.messageError);return null}i=this._getLinkTarget((_=o.joints.invBindMatrices)!=null?_.source:void 0,M);if(!(i!=null)||!(i.data!=null)){this._log("Skin has no inverse bind matrix source, mesh ignored",N.messageError);return null}if(s.data.length*16!==i.data.length){this._log("Skin has an inconsistent length of joint data sources, mesh ignored",N.messageError);return null}r=[];D=s.data;for(b=0,x=D.length;b<x;b++){l=D[b];f=this._findJointNode(l,v);if(!(f!=null)){this._log("Joint "+l+" not found for skin with skeletons "+v.map(function(e){return e.id}).join(", ")+", mesh ignored",N.messageError);return null}n=this._createBone(f,l,r);J(i.data,n.index*16,n.invBindMatrix)}if(this._options["verboseMessages"]){this._log("Skin contains "+r.length+" bones",N.messageInfo)}a=0;while(a<r.length){n=r[a];a=a+1;for(w=0,T=r.length;w<T;w++){h=r[w];if(n.node.parent===h.node){n.parent=h;break}}if(n.node.parent!=null&&n.node.parent instanceof j&&!(n.parent!=null)){n.parent=this._createBone(n.node.parent,"",r)}}if(this._options["verboseMessages"]){this._log("Skeleton contains "+r.length+" bones",N.messageInfo)}if(!(o.vertexWeights!=null)){this._log("Skin has no vertex weight data, mesh ignored",N.messageError);return null}if(o.vertexWeights.joints.source.url!==o.joints.joints.source.url){this._log("Skin uses different data sources for joints in <joints> and <vertex_weights>, this is not supported by this loader, mesh ignored",N.messageError);return null}P=this._createGeometryAndMaterial(u,e.materials),m=P[0],g=P[1];if(this._options["convertSkinsToMorphs"]){if(this._addSkinMorphTargets(m,o,r,g)){return new THREE.MorphAnimMesh(m,g)}else{return new THREE.Mesh(m,g)}}else{if(this._addSkinBones(m,o,r,g)){c=new THREE.SkinnedMesh(m,g);c.boneInverses=[];H=m.bones;for(E=0,C=H.length;E<C;E++){n=H[E];c.boneInverses.push(n.inverse)}return c}else{return new THREE.Mesh(m,g)}}return null};h.prototype._findJointNode=function(e,t){var n,r,i,s;n=null;for(i=0,s=t.length;i<s;i++){r=t[i];n=this._findSidTarget(r,e);if(n!=null)break}if(n instanceof j){return n}else{return null}};h.prototype._createBone=function(e,t,n){var r,i,s,o,u;r=new R;r.sid=t;r.node=e;u=e.transformations;for(s=0,o=u.length;s<o;s++){i=u[s];if(i.animTarget.channels.length>0){r.isAnimated=true;break}}r.matrix=new THREE.Matrix4;e.getTransformMatrix(r.matrix);r.index=n.length;n.push(r);return r};h.prototype._addSkinMorphTargets=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,C,k,L,A,O,M,_,D,P,H,B,j,F,I;g=this._prepareAnimations(n);if(!g>0)return null;d=e.vertices;w=d.length;C=t.vertexWeights.v;k=t.vertexWeights.vcount;T=this._getLinkTarget(t.vertexWeights.joints.source);A=this._getLinkTarget(t.vertexWeights.weights.source);x=T!=null?T.data:void 0;L=A!=null?A.data:void 0;if(!(L!=null)){this._log("Skin has no weights data, no morph targets added for mesh",N.messageError);return null}i=new THREE.Matrix4;if(t.bindShapeMatrix!=null){i=Q(t.bindShapeMatrix,0)}m=new THREE.Vector3;l=true;f=true;for(c=0,j=g-1;c<=j;c+=1){this._updateSkinMatrices(n,i,c);E=[];for(_=0,P=d.length;_<P;_++){v=d[_];E.push(new THREE.Vector3)}S=0;for(c=0,H=E.length;c<H;c++){b=E[c];p=d[c];M=k[c];y=0;for(O=0,F=M-1;O<=F;O+=1){o=C[S];a=C[S+1];S+=2;u=L[a];y+=u;if(o>=0){s=n[o];m.copy(p);m.applyMatrix4(s.skinMatrix);m.multiplyScalar(u);b.add(m)}else{m.copy(p);m.applyMatrix4(i);m.multiplyScalar(u);b.add(m)}}if(M===0){b.copy(p);if(l){this._log("Skinned vertex not influenced by any bone, some vertices will be unskinned",N.messageWarning);l=false}}else if(!(.01<y&&y<1e6)){b.copy(p);if(f){this._log("Zero or infinite total weight for skinned vertex, some vertices will be unskinned",N.messageWarning);f=false}}else{b.multiplyScalar(1/y)}}if(S!==C.length){this._log("Skinning did not consume all weights",N.messageError)}e.morphTargets.push({name:"target",vertices:E})}e.computeMorphNormals();r.morphTargets=true;r.morphNormals=true;if(r.materials!=null){I=r.materials;for(D=0,B=I.length;D<B;D++){h=I[D];h.morphTargets=true;h.morphNormals=true}}return true};h.prototype._prepareAnimations=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;s=null;for(u=0,l=e.length;u<l;u++){t=e[u];i=false;p=t.node.transformations;for(a=0,c=p.length;a<c;a++){o=p[a];o.resetAnimation();o.selectAllAnimations();d=o.animTarget.activeChannels;for(f=0,h=d.length;f<h;f++){n=d[f];i=true;r=n.inputData.length;if(s!=null&&r!==s){this._log("Inconsistent number of time steps, no morph targets added for mesh. Resample all animations to fix this.",N.messageError);return null}s=r}}if(this._options["verboseMessages"]&&!i){this._log("Joint '"+t.sid+"' has no animation channel",N.messageWarning)}}return s};h.prototype._updateSkinMatrices=function(e,t,n){var r,i,s,o,u;for(i=0,o=e.length;i<o;i++){r=e[i];r.applyAnimation(n)}for(s=0,u=e.length;s<u;s++){r=e[s];r.updateSkinMatrix(t)}return null};h.prototype._addSkinBones=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,G,Y,Z,et;L=this._prepareAnimations(n);if(!L>0)return null;w=e.vertices;M=w.length;H=t.vertexWeights.v;B=t.vertexWeights.vcount;P=this._getLinkTarget(t.vertexWeights.joints.source);F=this._getLinkTarget(t.vertexWeights.weights.source);D=P!=null?P.data:void 0;j=F!=null?F.data:void 0;if(!(j!=null)){this._log("Skin has no weights data, no skin added for mesh",N.messageError);return null}i=new THREE.Matrix4;if(t.bindShapeMatrix!=null){i=Q(t.bindShapeMatrix,0)}g=new THREE.Vector3;y=new THREE.Quaternion;b=new THREE.Vector3;c=true;l=true;C=[];k=[];_=0;f=4;p=[0,0,0,0];R=[0,0,0,0];for(h=0,X=w.length;h<X;h++){O=w[h];q=B[h];if(q>f){if(c){this._log("Too many bones influence a vertex, some influences will be discarded. Threejs supports only "+f+" bones per vertex.",N.messageWarning);c=false}q=f}A=0;for(I=0,K=q-1;I<=K;I+=1){o=H[_];a=H[_+1];_+=2;u=j[a];A+=u;p[I]=o;R[I]=u}for(I=R,G=f-1;I<=G;I+=1){p[I]=0;R[I]=0}if(!(.01<A&&A<1e6)){if(l){this._log("Zero or infinite total weight for skinned vertex, skin will be broken",N.messageWarning);l=false}}else{for(I=0,Y=f-1;I<=Y;I+=1){R[I]/=A}}C.push(new THREE.Vector4(p[0],p[1],p[2],p[3]));k.push(new THREE.Vector4(R[0],R[1],R[2],R[3]))}e.skinIndices=C;e.skinWeights=k;T=[];for(U=0,V=n.length;U<V;U++){s=n[U];S={};if(s.parent!=null){S.parent=s.parent.index}else{S.parent=-1}S.name=s.node.name;s.matrix.decompose(g,y,b);S.pos=[g.x,g.y,g.z];S.scl=[b.x,b.y,b.z];S.rotq=[y.x,y.y,y.z,y.w];S.rot=null;S.inverse=new THREE.Matrix4;S.inverse.multiplyMatrices(s.invBindMatrix,i);T.push(S)}e.bones=T;E={};E.name="animation";E.hierarchy=[];for(z=0,$=n.length;z<$;z++){s=n[z];x={};x.parent=s.index;x.keys=[];for(v=0,Z=L-1;v<=Z;v+=1){s.applyAnimation(v);s.updateSkinMatrix(i);d={};d.time=v;s.matrix.decompose(g,y,b);d.pos=[g.x,g.y,g.z];d.scl=[b.x,b.y,b.z];d.rot=[y.x,y.y,y.z,y.w];x.keys.push(d)}E.hierarchy.push(x)}E.fps=30;E.length=L-1;e.animation=E;r.skinning=true;if(r.materials!=null){et=r.materials;for(W=0,J=et.length;W<J;W++){m=et[W];m.skinning=true}}return true};h.prototype._createMorphMesh=function(e,t){this._log("Morph animated meshes not supported, mesh ignored",N.messageError);return null};h.prototype._createGeometry=function(e,t){var n,r,i,s,o,u;r=new THREE.Geometry;u=e.triangles;for(s=0,o=u.length;s<o;s++){i=u[s];n=t.indices[i.material];if(!(n!=null)){this._log("Material symbol "+i.material+" has no bound material instance",N.messageError);n=0}this._addTrianglesToGeometry(e,i,n,r)}r.computeFaceNormals();r.computeCentroids();if(t.needtangents)r.computeTangents();r.computeBoundingBox();return r};h.prototype._addTrianglesToGeometry=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,C,k,L,A,O,_,D,P,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt=this;C=null;x=null;S=null;T=[];gt=t.inputs;for(ut=0,lt=gt.length;ut<lt;ut++){E=gt[ut];switch(E.semantic){case"VERTEX":C=E;break;case"NORMAL":x=E;break;case"COLOR":S=E;break;case"TEXCOORD":T.push(E);break;default:this._log("Unknown triangles input semantic "+E.semantic+" ignored",N.messageWarning)}}X=this._getLinkTarget(C.source,H);if(!(X!=null)){this._log("Geometry "+e.id+" has no vertices",N.messageError);return}z=this._getLinkTarget(x!=null?x.source:void 0,M);U=this._getLinkTarget(S!=null?S.source:void 0,M);W=T.map(function(e){return xt._getLinkTarget(e!=null?e.source:void 0,M)});A=null;L=null;k=null;O=[];yt=X.inputs;for(at=0,ct=yt.length;at<ct;at++){E=yt[at];switch(E.semantic){case"POSITION":A=E;break;case"NORMAL":L=E;break;case"COLOR":k=E;break;case"TEXCOORD":O.push(E);break;default:this._log("Unknown vertices input semantic "+E.semantic+" ignored",N.messageWarning)}}J=this._getLinkTarget(A.source,M);if(!(J!=null)){this._log("Geometry "+e.id+" has no vertex positions",N.messageError);return}$=this._getLinkTarget(L!=null?L.source:void 0,M);V=this._getLinkTarget(k!=null?k.source:void 0,M);K=O.map(function(e){return xt._getLinkTarget(e!=null?e.source:void 0,M)});v=this._createVector3Array(J);d=this._createVector3Array($);c=this._createVector3Array(z);p=this._createColorArray(V);l=this._createColorArray(U);m=K.map(function(e){return xt._createUVArray(e)});h=W.map(function(e){return xt._createUVArray(e)});r.vertices=v;R=m.length+h.length;I=r.faceVertexUvs.length;q=t.count;F=r.faces.count;bt=r.faceVertexUvs;for(b=0,ht=bt.length;b<ht;b++){y=bt[b];if(b<R){_=y.length-r.faces.length;this._addEmptyUVs(y,_)}else{_=y.length-r.faces.length+q;this._addEmptyUVs(y,_)}}while(r.faceVertexUvs.length<R){y=[];this._addEmptyUVs(y,F);r.faceVertexUvs.push(y)}if(t.type!=="triangles"){st=t.vcount;for(ft=0,pt=st.length;ft<pt;ft++){u=st[ft];if(u!==3){this._log("Geometry "+e.id+" has non-triangle polygons, geometry ignored",N.messageError);return}}}w=t.indices;tt=w.length/t.count;ot=tt/3;wt=t.indices;for(et=0,dt=wt.length,Et=tt;et<dt;et+=Et){St=wt[et];i=et+0*ot;s=et+1*ot;o=et+2*ot;nt=w[i+C.offset];rt=w[s+C.offset];it=w[o+C.offset];if(d!=null){j=[d[nt],d[rt],d[it]]}else if(c!=null){D=w[i+x.offset];P=w[s+x.offset];B=w[o+x.offset];j=[c[D],c[P],c[B]]}else{j=null}if(p!=null){a=[p[nt],p[rt],p[it]]}else if(l!=null){D=w[i+S.offset];P=w[s+S.offset];B=w[o+S.offset];a=[l[D],l[P],l[B]]}else{a=null}g=new THREE.Face3(nt,rt,it,j,a);if(n!=null)g.materialIndex=n;r.faces.push(g);for(b=0,vt=m.length;b<vt;b++){f=m[b];if(!(f!=null)){geometry.faceVertexUvs[b].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)])}else{Z=[f[nt],f[rt],f[it]];geometry.faceVertexUvs[b].push(Z)}}for(b=0,mt=h.length;b<mt;b++){f=h[b];if(!(f!=null)){geometry.faceVertexUvs[b].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)])}else{Q=w[i+T[b].offset];G=w[s+T[b].offset];Y=w[o+T[b].offset];Z=[f[Q],f[G],f[Y]];r.faceVertexUvs[b].push(Z)}}}};h.prototype._addEmptyUVs=function(e,t){var n,r;for(n=0,r=t-1;n<=r;n+=1){e.push(new THREE.Vector2(0,0))}};h.prototype._createVector3Array=function(e){var t,n,r,i;if(!(e!=null))return null;if(e.stride!==3){this._log("Vector source data does not contain 3D vectors",N.messageError);return null}t=[];r=e.data;for(n=0,i=r.length-1;n<=i;n+=3){t.push(new THREE.Vector3(r[n],r[n+1],r[n+2]))}return t};h.prototype._createColorArray=function(e){var t,n,r,i,s;if(!(e!=null))return null;if(e.stride<3){this._log("Color source data does not contain 3+D vectors",N.messageError);return null}t=[];r=e.data;for(n=0,i=r.length-1,s=e.stride;0<=i?n<=i:n>=i;n+=s){t.push((new THREE.Color).setRGB(r[n],r[n+1],r[n+2]))}return t};h.prototype._createUVArray=function(e){var t,n,r,i,s;if(!(e!=null))return null;if(e.stride<2){this._log("UV source data does not contain 2+D vectors",N.messageError);return null}t=[];r=e.data;for(n=0,i=r.length-1,s=e.stride;0<=i?n<=i:n>=i;n+=s){t.push(new THREE.Vector2(r[n],1-r[n+1]))}return t};h.prototype._createMaterials=function(e){var t,n,r,i,s,o,u;r=new q;n=0;for(o=0,u=e.length;o<u;o++){t=e[o];i=t.symbol;if(!(i!=null)){this._log("Material instance has no symbol, material skipped.",N.messageError);continue}if(r.indices[i]!=null){this._log("Geometry instance tried to map material symbol "+i+" multiple times",N.messageError);continue}s=this._createMaterial(t);if(s.bumpMap!=null||s.normalMap!=null){r.needtangents=true}this.threejs.materials.push(s);r.materials.push(s);r.indices[i]=n++}return r};h.prototype._createMaterial=function(e){var t,n;n=this._getLinkTarget(e.material,C);if(!(n!=null))return this._createDefaultMaterial;t=this._getLinkTarget(n.effect,a);if(!(t!=null))return this._createDefaultMaterial;return this._createBuiltInMaterial(t)};h.prototype._createShaderMaterial=function(e){var t,n,r,i,s,o,u,a,f,l,c;r=e.technique;n=THREE.ShaderUtils.lib["normal"];a=THREE.UniformsUtils.clone(n.uniforms);o=this._loadThreejsTexture(r.bump);if(o!=null){a["tNormal"].texture=o;a["uNormalScale"].value=.85}i=this._loadThreejsTexture(r.diffuse);if(i!=null){a["tDiffuse"].texture=i;a["enableDiffuse"].value=true}else{a["enableDiffuse"].value=false}u=this._loadThreejsTexture(r.specular);if(u!=null){a["tSpecular"].texture=u;a["enableSpecular"].value=true}else{a["enableSpecular"].value=false}s=this._loadThreejsTexture(r.emission);if(s!=null){a["tAO"].texture=s;a["enableAO"].value=true}else{a["enableAO"].value=false}if(((f=r.diffuse)!=null?f.color:void 0)!=null){a["uDiffuseColor"].value.setHex(V(r.diffuse.color))}if(((l=r.specular)!=null?l.color:void 0)!=null){a["uSpecularColor"].value.setHex(V(r.specular.color))}if(((c=r.ambient)!=null?c.color:void 0)!=null){a["uAmbientColor"].value.setHex(V(r.ambient.color))}if(r.shininess!=null){a["uShininess"].value=r.shininess}if(r.transparency!=null){a["uOpacity"].value=this._getOpacity(e)}t=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:a,lights:true});return t};h.prototype._getOpacity=function(e){var t,n,r,i,s,o;n=e.technique;i=n.transparent;t=i!=null?i.opaque:void 0;if(t!=null&&t!=="A_ONE"){this._log("Opacity mode "+t+" not supported, transparency will be broken",N.messageWarning)}if((i!=null?i.textureSampler:void 0)!=null){this._log("Separate transparency texture not supported, transparency will be broken",N.messageWarning)}s=(i!=null?(o=i.color)!=null?o[3]:void 0:void 0)||1;r=n.transparency||1;return s*r};h.prototype._hasTransparency=function(e){var t,n,r;t=e.technique;return((n=t.transparent)!=null?n.textureSampler:void 0)!=null||0>=(r=t.transparency)&&r>=1};h.prototype._createBuiltInMaterial=function(e){var t,n,r,i;i=e.technique;r={};this._setThreejsMaterialParam(r,i.diffuse,"diffuse","map",false);this._setThreejsMaterialParam(r,i.emission,"emissive",null,false);this._setThreejsMaterialParam(r,i.ambient,"ambient","lightMap",false);this._setThreejsMaterialParam(r,i.specular,"specular","specularMap",false);this._setThreejsMaterialParam(r,i.bump,null,"normalMap",false);if(r["bumpMap"])r["bumpScale"]=1;if(r["normalMap"])r["normalScale"]=new THREE.Vector2(1,1);if(r["map"]!=null)r["diffuse"]=16777215;if(r["specularMap"]!=null)r["specular"]=16777215;if(!(r["diffuse"]!=null))r["diffuse"]=16777215;if(i.shininess!=null)r["shininess"]=i.shininess;if(i.reflectivity!=null){r["reflectivity"]=i.reflectivity}t=this._hasTransparency(e);if(t){r["transparent"]=true;n=this._getOpacity(e);r["opacity"]=n;r["alphaTest"]=.001}if(i.doubleSided)r["side"]=THREE.DoubleSide;r["shading"]=THREE.SmoothShading;r["perPixel"]=true;switch(i.shading){case"blinn":case"phong":r["color"]=r["diffuse"];return new THREE.MeshPhongMaterial(r);case"lambert":r["color"]=r["diffuse"];return new THREE.MeshLambertMaterial(r);case"constant":r["color"]=r["emission"];return new THREE.MeshBasicMaterial(r);default:return this._createDefaultMaterial}};h.prototype._createDefaultMaterial=function(){return new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading})};h.prototype._setThreejsMaterialParam=function(e,t,n,r,i){var s;if(!(t!=null))return;if(t.color!=null&&n!=null){if(!i&&e[n]!=null)return;e[n]=V(t.color)}else if(t.textureSampler!=null&&r!=null){if(!i&&e[r]!=null)return;s=this._loadThreejsTexture(t);if(s!=null)e[r]=s}};h.prototype._loadThreejsTexture=function(e){var t,n,r,i,s;if(!(e.textureSampler!=null))return null;i=this._getLinkTarget(e.textureSampler,f);if(!(i!=null))return null;r=null;if(i.image!=null){r=this._getLinkTarget(i.image,v)}else if(i.surface!=null){s=this._getLinkTarget(i.surface,l);r=this._getLinkTarget(s.initFrom,v)}if(!(r!=null))return null;t=this._baseUrl+r.initFrom;n=this._loader._loadTextureFromURL(t);return n};return h}();N=function(){function e(){this.log=e.logConsole;this._imageCache={};this.options={useAnimations:true,convertSkinsToMorphs:false,verboseMessages:false,localImageMode:false}}e.messageTrace=0;e.messageInfo=1;e.messageWarning=2;e.messageError=3;e.messageTypes=["TRACE","INFO","WARNING","ERROR"];e.logConsole=function(t,n){console.log("ColladaLoader2 "+e.messageTypes[n]+": "+t)};e.prototype.setLog=function(e){this.log=e||this.logConsole};e.prototype.addChachedTextures=function(e){var t,n;for(t in e){n=e[t];this._imageCache[t]=n}};e.prototype.load=function(t,n,r){var i,s,o,u=this;i=0;if((o=document.implementation)!=null?o.createDocument:void 0){s=new XMLHttpRequest;if(typeof s.overrideMimeType==="function"){s.overrideMimeType("text/xml")}s.onreadystatechange=function(){if(s.readyState===4){if(s.status===0||s.status===200){if(s.responseXML){return u.parse(s.responseXML,n,t)}else{return u.log("Empty or non-existing file "+t+".",e.messageError)}}}else if(s.readyState===3){if(r){if(i===0)i=s.getResponseHeader("Content-Length");return r({total:i,loaded:s.responseText.length})}}};s.open("GET",t,true);s.send(null)}else{this.log("Don't know how to parse XML!",e.messageError)}};e.prototype.parse=function(e,t,n){var r;r=new h(this);r.setUrl(n);r._readyCallback=t;r._parseXml(e);r._linkAnimations();r._createSceneGraph();if(r._readyCallback)r._readyCallback(r);return r};e.prototype._loadTextureFromURL=function(t){var n;n=this._imageCache[t];if(n!=null)return n;if(this.options.localImageMode)n=this._loadImageLocal(t);if(!(n!=null))n=this._loadImageSimple(t);if(n!=null){this._imageCache[t]=n}else{this.log("Texture "+t+" could not be loaded, texture will be ignored.",e.messageError)}return n};e.prototype._loadImageThreejs=function(e){var t;t=THREE.ImageUtils.loadTexture(e);t.flipY=false;return t};e.prototype._loadImageSimple=function(e){var t,n;t=new Image;n=new THREE.Texture(t);n.flipY=false;n.wrapS=THREE.RepeatWrapping;n.wrapT=THREE.RepeatWrapping;t.onload=function(){return n.needsUpdate=true};t.crossOrigin="anonymous";t.src=e;return n};e.prototype._loadImageLocal=function(e){var t,n,r,i,s,o,u;n=this._removeSameDirectoryPath(e);o=this._imageCache;for(r in o){s=o[r];t=this._removeSameDirectoryPath(r);if(n.indexOf(t)>=0){i=s;break}}n=this._removeSameDirectoryPath(this._removeFileExtension(e));if(!(i!=null)){u=this._imageCache;for(r in u){s=u[r];t=this._removeSameDirectoryPath(this._removeFileExtension(r));if(n.indexOf(t)>=0){i=s;break}}}return i};e.prototype._removeFileExtension=function(e){return e.substr(0,e.lastIndexOf("."))||e};e.prototype._removeSameDirectoryPath=function(e){return e.replace(/^.\//,"")};return e}();nt=function(e){var t;if(e.length>0){t=e.trim();return t.split(/\s+/)}else{return[]}};et=function(e){var t,n,r,i,s;i=nt(e);t=new Float32Array(i.length);for(n=0,s=i.length;n<s;n++){r=i[n];t[n]=parseFloat(r)}return t};tt=function(e){var t,n,r,i,s;i=nt(e);t=new Int32Array(i.length);for(n=0,s=i.length;n<s;n++){r=i[n];t[n]=parseInt(r,10)}return t};Y=function(e){var t,n,r,i,s,o;i=nt(e);t=new Uint8Array(i.length);for(n=0,s=i.length;n<s;n++){r=i[n];t[n]=(o=r==="true"||r==="1")!=null?o:{1:0}}return t};Z=function(e){var t;t=et(e);if(t.length===4){return t}else{return null}};V=function(e){if(e!=null){return Math.floor(e[0]*255)<<16^Math.floor(e[1]*255)<<8^Math.floor(e[2]*255)}else{return null}};K=function(e,t){return new THREE.Matrix4(e[0+t],e[4+t],e[8+t],e[12+t],e[1+t],e[5+t],e[9+t],e[13+t],e[2+t],e[6+t],e[10+t],e[14+t],e[3+t],e[7+t],e[11+t],e[15+t])};Q=function(e,t){return new THREE.Matrix4(e[0+t],e[1+t],e[2+t],e[3+t],e[4+t],e[5+t],e[6+t],e[7+t],e[8+t],e[9+t],e[10+t],e[11+t],e[12+t],e[13+t],e[14+t],e[15+t])};$=function(e,t,n){return n.set(e[0+t],e[4+t],e[8+t],e[12+t],e[1+t],e[5+t],e[9+t],e[13+t],e[2+t],e[6+t],e[10+t],e[14+t],e[3+t],e[7+t],e[11+t],e[15+t])};J=function(e,t,n){return n.set(e[0+t],e[1+t],e[2+t],e[3+t],e[4+t],e[5+t],e[6+t],e[7+t],e[8+t],e[9+t],e[10+t],e[11+t],e[12+t],e[13+t],e[14+t],e[15+t])};X=function(e){var t,n,r,i;i=e.elements;if(i[3]!==0||i[7]!==0||i[11]!==0||i[15]!==1){throw new Error("Last row isnt [0,0,0,1]")}t=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);n=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]);r=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]);if(t<.9||t>1.1){throw new Error("First column has significant scaling")}if(n<.9||n>1.1){throw new Error("Second column has significant scaling")}if(r<.9||r>1.1){throw new Error("Third column has significant scaling")}};G=function(e){return new THREE.Vector3(e[0],e[1],e[2])};F=Math.PI/180;N.prototype["setLog"]=N.prototype.setLog;N.prototype["addChachedTextures"]=N.prototype.addChachedTextures;N.prototype["load"]=N.prototype.load;N.prototype["parse"]=N.prototype.parse;if(typeof module!=="undefined"&&module!==null){module["exports"]=N}else if(typeof window!=="undefined"&&window!==null){window["ColladaLoader2"]=N}}).call(this)