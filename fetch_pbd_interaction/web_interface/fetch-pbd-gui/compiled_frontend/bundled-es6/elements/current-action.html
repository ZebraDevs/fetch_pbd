<html><head></head><body><div hidden="" by-polymer-bundler=""><iron-iconset-svg name="marker_icons"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="100.000000pt" height="100.000000pt" viewBox="0 0 100.000000 100.000000" preserveAspectRatio="xMidYMid meet"><defs><g id="hide_marker" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none" viewBox="0 0 100.000000 100.000000"><path d="M560 623 c-140 -146 -305 -318 -367 -382 l-111 -117 32 -26 32 -25
             254 265 c140 145 304 316 364 379 l109 114 -29 29 -29 29 -255 -266z"></path><path d="M360 775 l0 -105 -31 0 c-33 0 -98 -27 -100 -41 -2 -13 -5 -22 -13
             -39 -3 -9 -5 -82 -4 -163 l3 -146 212 222 213 222 0 78 0 77 -40 0 -40 0 0
             -105 0 -105 -60 0 -60 0 0 105 0 105 -40 0 -40 0 0 -105z"></path><path d="M669 602 c-29 -31 -111 -118 -183 -192 -72 -74 -159 -165 -194 -201
             -45 -47 -60 -69 -51 -74 8 -6 10 -4 5 6 -4 8 -1 6 7 -3 8 -10 17 -15 20 -11 4
             3 7 1 7 -5 0 -17 421 -17 438 0 7 7 12 9 12 5 0 -3 10 4 23 16 13 12 21 28 19
             35 -2 6 1 12 7 12 8 0 11 58 11 190 0 202 -8 248 -48 269 -17 9 -27 2 -73 -47z"></path></g><g id="show_marker" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none" viewBox="0 0 100.000000 100.000000"><path d="M360 776 l0 -103 -52 -5 c-40 -4 -57 -11 -75 -32 -23 -27 -23 -32
             -23 -247 l0 -221 29 -29 29 -29 231 0 c229 0 230 0 258 24 l28 24 3 222 3 221
             -34 34 c-29 29 -43 35 -76 35 l-41 0 0 105 0 105 -40 0 -40 0 0 -105 0 -105
             -60 0 -60 0 0 105 0 105 -40 0 -40 0 0 -104z"></path></g></defs></svg></iron-iconset-svg></div><dom-module id="current-action"><template><style include="iron-flex iron-flex-alignment"><style is='custom-style'>
      .flex-vertical{@apply (--layout-vertical);height:500px;}.flexchild-vertical{@apply (--layout-flex);}.flex-container{display:flex;flex-direction:column;max-height:510px;}#primitiveListContainer{width:500px;float:right;display:block;}section{width:100%;height:600px;@apply (--layout-vertical);}section paper-dialog-scrollable{@apply (--layout-flex);}.flex-horizontal{@apply (--layout-horizontal);width:100%;}.flexchild-horizontal{@apply (--layout-flex);}#viewer{overflow:hidden;padding-left:32px;height:600px;}#actionName{padding-left:32px;}#buttons{padding-left:32px;}.left-content{display:flex;line-height:3;align-items:center;}.left-content > .left-content-item-name{flex:auto;}paper-button{@apply (--paper-font-button);border-radius:2px;padding:6px 16px;height:36px;vertical-align:middle;display:inline-block;}paper-button:hover{background-color:#e0e0e0;}paper-button.delete:hover{background-color:#FFCDD2;}paper-icon-button{vertical-align:middle;display:inline-block;}paper-icon-button:hover{background-color:#e0e0e0;}paper-icon-button.delete:hover{background-color:#FFCDD2;}drag-sort-list{margin:15px;}drag-sort-list > div{background:white;border:1px solid #ddd;border-radius:3px;padding:6px 12px;margin-bottom:3px;}.title{@apply (--paper-font-headline);margin-bottom:5px;text-align:center;}.delete{color:#D32F2F;}.backdrop{background-color:#fff;}.primitiveList{border-spacing:0;width:100%;}.primitiveList th, td{padding:5px 10px;}.primitiveList th{text-align:left;padding:15px;}.primitiveList tr:last-child td{border-bottom:none;}.listDiv{border-bottom:1px solid var(--divider-color);border-top:1px solid var(--divider-color);}</style><div id="container" class="container flex-vertical"><paper-input id="actionName" label="Action name" class="programName flex" value="{{action_name}}" on-change="onNameChange"></paper-input><div id="container" class="flex-horizontal"><div id="viewer" class="flex"></div><div id="primitiveListContainer"><div class="title">Primitive List</div><table id="primitiveList" class="primitiveList"><thead><tr><th>Primitives</th><th>Options</th></tr></thead></table><div class="flex-container" style="overflow:auto"><ul id="dragList" style="list-style: none; padding: 5px; margin: 0px"><template is="dom-repeat" items="{{primitives}}"><li draggable="true" on-dragstart="dragPrimitive" on-dragend="dropPrimitive" on-dragenter="getDestination" on-click="selectPrimitive"><div class="listDiv" style="{{item.backgroundColor}}"><div style="display: flex"><div style="flex:auto; line-height: 36px; vertical-align: middle; display: inline-block">{{item.name}}</div><div style="flex:none"><paper-icon-button noink="" data-primitive$="{{item.number}}" on-tap="onRun" icon="av:play-circle-filled"></paper-icon-button></div><div style="flex:none"><paper-icon-button noink="" data-primitive$="{{item.number}}" on-tap="onCopy" icon="content-copy"></paper-icon-button></div><div style="flex:none"><paper-icon-button noink="" data-primitive$="{{item.number}}" on-tap="onEdit" icon="image:edit" disabled="{{item.editDisabled}}"></paper-icon-button></div><div style="flex:none"><paper-icon-button class="delete" noink="" data-primitive$="{{item.number}}" on-tap="onDelete" icon="delete"></paper-icon-button></div><div style="flex:none"><paper-icon-button noink="" data-primitive$="{{item.number}}" on-tap="toggleMarker" icon="{{item.marker}}"></paper-icon-button></div></div><div class="collapsible" style="display: none"><div style="float: left; padding: 5px"><paper-input on-change="onPoseEdit" type="number" value="{{item.position.x}}"><div prefix="">x:</div></paper-input><paper-input on-change="onPoseEdit" type="number" value="{{item.position.y}}"><div prefix="">y:</div></paper-input><paper-input on-change="onPoseEdit" type="number" value="{{item.position.z}}"><div prefix="">z:</div></paper-input></div><div style="float: right; padding: 5px"><paper-input on-change="onPoseEdit" type="number" value="{{item.orientation.r}}"><div prefix="">r:</div></paper-input><paper-input on-change="onPoseEdit" type="number" value="{{item.orientation.p}}"><div prefix="">p:</div></paper-input><paper-input on-change="onPoseEdit" type="number" value="{{item.orientation.y}}"><div prefix="">y:</div></paper-input></div></div></div></li></template></ul></div></div></div><div id="buttons" class="flexchild-vertical"><paper-button raised="" id="execute_button" on-tap="execute"><iron-icon icon="av:play-circle-filled"></iron-icon>Run</paper-button><paper-button raised="" id="stop_execution_button" on-tap="stopExecution">Stop Execution</paper-button><paper-button raised="" id="save_pose_button" on-tap="savePose">Save Pose</paper-button><paper-button raised="" id="record_objects_button" on-tap="recordObjects">Record Objects</paper-button><paper-button raised="" id="start_recording_button" on-tap="startRecording">Start Recording Trajectory</paper-button><paper-button raised="" id="stop_recording_button" on-tap="stopRecording">Stop Recording Trajectory</paper-button><paper-button raised="" id="open_hand_button" on-tap="openHand">Open Hand</paper-button><paper-button raised="" id="close_hand_button" on-tap="closeHand">Close Hand</paper-button><paper-button raised="" id="delete_all_button" on-tap="deleteAll">Delete All Primitives</paper-button><paper-button raised="" id="delete_last_button" on-tap="deleteLast">Delete Last Primitive</paper-button></div></div><paper-dialog id="actionDialog"><h2>Status</h2><p>'{{statusMessage}}'</p><div class="buttons"><paper-button dialog-confirm="" autofocus="">OK</paper-button></div></paper-dialog></template><script>Polymer({is:'current-action',properties:{primitives:{type:Array,value:[]},globalOptions:{type:Object,value:function(){return{}},notify:!0},config:{computed:'_computeConfig(globalOptions, displays, sidebarOpened)',notify:!0,type:Object},displays:{type:Array,value:function(){return[]}},ros:{type:Object,observer:'_rosChanged'},sidebarOpened:{type:Boolean,value:!0},tfClient:Object,websocketUrl:{type:String,notify:!0,computed:'_computeWebsocketUrl(globalOptions.url)'},_viewer:Object,_urdf:Object,_grid:Object,_im:Object,expSrv:Object,inputSrv:Object,action_name:'',expListener:Object,statusListener:Object,loadedPublisher:Object,showMarkerIcon:{type:String,value:'marker_icons:show_marker'},hideMarkerIcon:{type:String,value:'marker_icons:hide_marker'},dragSource:Object,dragSourceId:Number,dropTarget:Object,dropTargetId:Number,statusMessage:String},behaviors:[Polymer.IronResizableBehavior],observers:['_fixedFrameChanged(globalOptions.fixedFrame)'],_fixedFrameChanged:function(a){this.tfClient&&(this.tfClient.fixedFrame=a,this.tfClient.updateGoal())},attached:function(){if(console.log('attached'),500>=screen.width){var a=document.getElementById('viewer');a.style.display='none'}var b=window.location.hostname,c=this;this.ros=new ROSLIB.Ros({url:'ws://'+b+':9090'});var d=this.$.viewer.offsetWidth;this._viewer=new ROS3D.Viewer({divID:'viewer',width:d,height:600,antialias:!0,background:'#78909C'}),this._viewer.addObject(new ROS3D.Grid),this.tfClient=new ROSLIB.TFClient({ros:this.ros,angularThres:0.01,transThres:0.01,rate:10,fixedFrame:'base_link'}),this.markerClient=new ROS3D.MarkerArrayClient({ros:this.ros,tfClient:this.tfClient,topic:'/fetch_pbd/visualization_marker_array',rootObject:this._viewer.scene}),this.urdf=new ROS3D.UrdfClient({ros:this.ros,tfClient:this.tfClient,path:'http://resources.robotwebtools.org/',rootObject:this._viewer.scene,loader:ROS3D.COLLADA_LOADER_2}),this._im=new ROS3D.InteractiveMarkerClient({ros:this.ros,tfClient:this.tfClient,path:'http://resources.robotwebtools.org/',topic:'/fetch_pbd/programmed_actions',camera:this._viewer.camera,rootObject:this._viewer.selectableObjects}),this._im_2=new ROS3D.InteractiveMarkerClient({ros:this.ros,tfClient:this.tfClient,path:'http://resources.robotwebtools.org/',topic:'/fetch_pbd/world_objects',camera:this._viewer.camera,rootObject:this._viewer.selectableObjects}),this.addEventListener('iron-resize',function(){c.resize()}),this.inputSrv=new ROSLIB.Service({ros:this.ros,name:'/fetch_pbd/gui_input',serviceType:'fetch_pbd_interaction/GuiInput'}),this.expSrv=new ROSLIB.Service({ros:this.ros,name:'/fetch_pbd/get_session_state',serviceType:'fetch_pbd_interaction/GetSessionState'});var f=new ROSLIB.ServiceRequest({});this.expSrv.callService(f,function(h){c.expCallback(c,h.state)}),this.expListener=new ROSLIB.Topic({ros:this.ros,name:'/fetch_pbd/session_state',messageType:'fetch_pbd_interaction/SessionState'}),this.expListener.subscribe(function(h){c.expCallback(c,h)}),this.statusListener=new ROSLIB.Topic({ros:this.ros,name:'/fetch_pbd/fetch_pbd_status',messageType:'std_msgs/String'}),this.statusListener.subscribe(function(h){c.statusCallback(c,h)}),this.loadedPublisher=new ROSLIB.Topic({ros:this.ros,name:'/fetch_pbd/action_loaded',messageType:'std_msgs/Empty'});var g=new ROSLIB.Message({});this.loadedPublisher.publish(g),this.resize()},isAbove:function(a,b){if(a.parentNode==b.parentNode)for(var c=a;c;c=c.previousSibling)if(c===b)return!0;return!1},dragPrimitive:function(a){this.dragSource=a.target,a.dataTransfer.effectAllowed='move',this.dragSourceId=a.model.item.number},getDestination:function(a){this.dropTargetId=a.model.item.number,this.dropTarget=document.getElementsByTagName('li')[parseInt(this.dropTargetId)]},dropPrimitive:function(){var b=this.dropTarget,c=this.dragSourceId,d=this.dropTargetId,e=new ROSLIB.ServiceRequest({command:'switch-primitive-order',list_params:[parseInt(c),parseInt(d)]});this.inputSrv.callService(e,function(){});var f=this.primitives,g=f[parseInt(c)];for(f.splice(parseInt(c),1),f.splice(parseInt(d),0,g),i=0;i<f.length;i++)f[i].number=i+'';this.primitives=[],this.primitives=f},selectPrimitive:function(a){if('DIV'==a.target.tagName){var b=new ROSLIB.ServiceRequest({command:'select-primitive',param:a.model.item.number});this.inputSrv.callService(b,function(){})}},statusCallback:function(a,b){if(console.log('Got status update'),''!=b.data){a.statusMessage=b.data,console.log('Making dialog');var c=document.getElementById('actionDialog');c.open()}},expCallback:function(a,b){for(a.action_name=b.action_names[b.current_action],i=0;i<a.primitives.length;i++)a.pop('primitives');a.primitives=[];var c=[];for(i=0;i<b.n_primitives;i++){var d=b.marker_visibility[i]?a.showMarkerIcon:a.hideMarkerIcon;var e=i==b.current_primitive?'background-color: #A5D6A7;':'background-color: #FFFFFF;';var f={name:b.primitive_names[i],number:i+'',marker:d,editDisabled:!b.primitive_pose_editable[i],position:{x:b.positions[i].x,y:b.positions[i].y,z:b.positions[i].z},orientation:{r:b.orientations[i].r,p:b.orientations[i].p,y:b.orientations[i].y},backgroundColor:e};c.push(f)}a.primitives=c},resize:function(){if(this._viewer){var a=this.$.viewer.offsetWidth;this._viewer.resize(a,600)}},onNameChange:function(){var a=this,b=new ROSLIB.ServiceRequest({command:'update-action-name',param:a.action_name});this.inputSrv.callService(b,function(){})},execute:function(){var a=new ROSLIB.ServiceRequest({command:'execute-action'});this.inputSrv.callService(a,function(){})},stopExecution:function(){var a=new ROSLIB.ServiceRequest({command:'stop-execution'});this.inputSrv.callService(a,function(){})},savePose:function(){var a=new ROSLIB.ServiceRequest({command:'save-target'});this.inputSrv.callService(a,function(){})},startRecording:function(){var a=new ROSLIB.ServiceRequest({command:'start-recording-trajectory'});this.inputSrv.callService(a,function(){})},stopRecording:function(){var a=new ROSLIB.ServiceRequest({command:'stop-recording-trajectory'});this.inputSrv.callService(a,function(){})},openHand:function(){var a=new ROSLIB.ServiceRequest({command:'open-hand'});this.inputSrv.callService(a,function(){})},closeHand:function(){var a=new ROSLIB.ServiceRequest({command:'close-hand'});this.inputSrv.callService(a,function(){})},deleteLast:function(){var a=new ROSLIB.ServiceRequest({command:'delete-last-primitive'});this.inputSrv.callService(a,function(){})},deleteAll:function(){var a=new ROSLIB.ServiceRequest({command:'delete-all-primitives'});this.inputSrv.callService(a,function(){})},recordObjects:function(){var a=new ROSLIB.ServiceRequest({command:'record-objects'});this.inputSrv.callService(a,function(){})},onEdit:function(a){var b=parseInt(a.model.item.number),c=document.getElementsByClassName('collapsible')[b];c.style.display='table-row'==c.style.display?'none':'table-row'},onPoseEdit:function(a){var b=a.model.item.number,c=new ROSLIB.ServiceRequest({command:'pose-edited',param:b,position:{x:parseFloat(a.model.item.position.x),y:parseFloat(a.model.item.position.y),z:parseFloat(a.model.item.position.z)},orientation:{r:parseFloat(a.model.item.orientation.r),p:parseFloat(a.model.item.orientation.p),y:parseFloat(a.model.item.orientation.y)}});this.inputSrv.callService(c,function(){})},onCopy:function(a){var b=a.model.item.number,c=new ROSLIB.ServiceRequest({command:'copy-primitive',param:b});this.inputSrv.callService(c,function(){})},onRun:function(a){var b=a.model.item.number,c=new ROSLIB.ServiceRequest({command:'execute-primitive',param:b});this.inputSrv.callService(c,function(){})},onDelete:function(a){var b=a.model.item.number,c=new ROSLIB.ServiceRequest({command:'delete-primitive',param:b});this.inputSrv.callService(c,function(){})},toggleMarker:function(a){var b=a.model.item.number,c;c=this.primitives[parseInt(b)].marker===this.showMarkerIcon?'hide-primitive-marker':'show-primitive-marker';var d=new ROSLIB.ServiceRequest({command:c,param:b});this.inputSrv.callService(d,function(){})}});</script></dom-module></body></html>