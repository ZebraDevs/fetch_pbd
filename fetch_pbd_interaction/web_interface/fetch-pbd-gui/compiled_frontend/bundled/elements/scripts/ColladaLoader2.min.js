(function(){var e,t,n,r,i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,E,C,A,N,M,S,I,L,U,R,j,H,O,D,V,W,q,G,F,P,B,X,z,J,K,Q,Y,Z,$=Object.prototype.hasOwnProperty,ee=function(e,t){function n(){this.constructor=e}for(var r in t)$.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};P=function(e,t){var n,r;for(r="",n=1;n<=e;n+=1)r+="    ";return r+=t},F=function(e,t){return P(e,"|-"+t)},G=function(e,t,n){return null==e?"":"string"==typeof e?F(t,n+"'"+e+"'\n"):"number"==typeof e?F(t,n+(e+"\n")):"boolean"==typeof e?F(t,n+(e+"\n")):null!=e.getInfo?e.getInfo(t,n):F(t,n+"<unknown data type>\n")},U=function(){function e(e){this.url=e.trim().replace(/^#/,""),this.object=null}return e.prototype.getInfo=function(e,t){return F(e,t+"<urlLink url='"+this.url+"'>\n")},e}(),d=function(){function e(e,t){this.url=e,this.scope=t,this.object=null}return e.prototype.getInfo=function(e,t){return F(e,t+"<fxLink url='"+this.url+"'>\n")},e}(),M=function(){function e(e,t){var n,r,i,a,s,o,l,h;for(this.url=t,this.object=null,this.id=null,this.sids=[],this.member=null,this.indices=null,this.dotSyntax=!1,this.arrSyntax=!1,o=t.split("/"),this.id=o.shift(),"."===this.id&&(this.id=e);o.length>1;)this.sids.push(o.shift());if(o.length>0)if(s=o[0],i=s.indexOf(".")>=0,r=s.indexOf("(")>=0,i)o=s.split("."),this.sids.push(o.shift()),this.member=o.shift(),this.dotSyntax=!0;else if(r){for(n=s.split("("),this.sids.push(n.shift()),this.indices=[],l=0,h=n.length;l<h;l++)a=n[l],this.indices.push(parseInt(a.replace(/\)/,""),10));this.arrSyntax=!0}else this.sids.push(s)}return e.prototype.getInfo=function(e,t){var n;return n="<sidLink id='"+this.id+"'",this.sids.length>0&&(n+=", sids='[",n+=this.sids.join(","),n+="]'"),n+=">\n",F(e,t+n)},e}(),t=function(){function e(){this.animTarget={},this.animTarget.channels=[],this.animTarget.activeChannels=[],this.animTarget.dataRows=null,this.animTarget.dataColumns=null}return e.prototype.selectAnimation=function(e){var t,n,r,i;for(this.animTarget.activeChannels=[],i=this.animTarget.channels,n=0,r=i.length;n<r;n++)t=i[n],e(t,n)&&this.animTarget.activeChannels.push(t)},e.prototype.selectAnimationById=function(e){this.selectAnimation(function(t,n){return t.animation.id===e})},e.prototype.selectAnimationByName=function(e){this.selectAnimation(function(t,n){return t.animation.name===e})},e.prototype.selectAllAnimations=function(e){this.selectAnimation(function(e,t){return!0})},e.prototype.applyAnimationKeyframe=function(e){throw new Error("applyAnimationKeyframe() not implemented")},e.prototype.initAnimationTarget=function(){throw new Error("initAnimationTarget() not implemented")},e.prototype.resetAnimation=function(){throw new Error("resetAnimation() not implemented")},e}(),n=function(){function e(){this.unit=1,this.upAxis=null}return e.prototype.getInfo=function(e,t){return F(e,t+"<asset>\n")},e}(),H=function(){function e(){this.id=null,this.children=[],this.sidChildren=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s;if(r=F(e,t+"<visualScene id='"+this.id+"'>\n"),null!=this.children)for(s=this.children,i=0,a=s.length;i<a;i++)n=s[i],r+=G(n,e+1,"child ");return r},e}(),O=function(){function e(){this.id=null,this.sid=null,this.name=null,this.type=null,this.layer=null,this.parent=null,this.children=[],this.sidChildren=[],this.transformations=[],this.geometries=[],this.controllers=[],this.lights=[],this.cameras=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d,f,m,g,_,y;if(r=F(e,t+"<visualSceneNode id='"+this.id+"', sid='"+this.sid+"', name='"+this.name+"'>\n"),null!=this.geometries)for(f=this.geometries,i=0,l=f.length;i<l;i++)n=f[i],r+=G(n,e+1,"geometry ");if(null!=this.controllers)for(m=this.controllers,a=0,h=m.length;a<h;a++)n=m[a],r+=G(n,e+1,"controller ");if(null!=this.lights)for(g=this.lights,s=0,u=g.length;s<u;s++)n=g[s],r+=G(n,e+1,"light ");if(null!=this.cameras)for(_=this.cameras,o=0,c=_.length;o<c;o++)n=_[o],r+=G(n,e+1,"camera ");if(null!=this.children)for(y=this.children,d=0,p=y.length;d<p;d++)n=y[d],r+=G(n,e+1,"child ");return r},e.prototype.getTransformMatrix=function(e){var t,n,r,i,a;for(t=new THREE.Matrix4,e.identity(),a=this.transformations,r=0,i=a.length;r<i;r++)n=a[r],n.getTransformMatrix(t),e.multiplyMatrices(e,t)},e}(),A=function(e){function t(){t.__super__.constructor.call(this),this.sid=null,this.type=null,this.data=null,this.originalData=null,this.node=null}return ee(t,e),t.prototype.getTransformMatrix=function(e){var t;switch(this.type){case"matrix":X(this.data,0,e);break;case"rotate":t=new THREE.Vector3(this.data[0],this.data[1],this.data[2]),e.makeRotationAxis(t,this.data[3]*D);break;case"translate":e.makeTranslation(this.data[0],this.data[1],this.data[2]);break;case"scale":e.makeScale(this.data[0],this.data[1],this.data[2]);break;default:throw new Error("transform type '"+this.type+"' not implemented")}},t.prototype.applyAnimationKeyframe=function(e){var t,n,r,i,a,s,o;for(s=this.animTarget.activeChannels,i=0,a=s.length;i<a;i++)for(t=s[i],r=t.outputData,n=0,o=t.count-1;n<=o;n+=1)this.data[t.offset+n]=r[e*t.stride+n]},t.prototype.initAnimationTarget=function(){var e,t,n;for(this.originalData=new Float32Array(this.data.length),n=this.data,e=0,t=n.length;e<t;e++)n[e],this.originalData[e]=this.data[e];switch(this.type){case"matrix":this.animTarget.dataColumns=4,this.animTarget.dataRows=4;break;case"rotate":this.animTarget.dataColumns=4,this.animTarget.dataRows=1;break;case"translate":case"scale":this.animTarget.dataColumns=3,this.animTarget.dataRows=1;break;default:throw new Error("transform type '"+this.type+"' not implemented")}},t.prototype.resetAnimation=function(){var e,t,n;for(n=this.originalData,e=0,t=n.length;e<t;e++)n[e],this.data[e]=this.originalData[e]},t}(t),b=function(){function e(){this.geometry=null,this.materials=[],this.sidChildren=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s;for(r=F(e,t+"<instanceGeometry>\n"),r+=G(this.geometry,e+1,"geometry "),s=this.materials,i=0,a=s.length;i<a;i++)n=s[i],r+=G(n,e+1,"material ");return r},e}(),y=function(){function e(){this.controller=null,this.skeletons=[],this.materials=[],this.sidChildren=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s,o,l,h,u;for(r=F(e,t+"<instanceController>\n"),r+=G(this.controller,e+1,"controller "),h=this.skeletons,a=0,o=h.length;a<o;a++)i=h[a],r+=G(i,e+1,"skeleton ");for(u=this.materials,s=0,l=u.length;s<l;s++)n=u[s],r+=G(n,e+1,"material ");return r},e}(),k=function(){function e(){this.sid=null,this.symbol=null,this.material=null,this.name=null,this.vertexInputs={},this.params={}}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<instanceMaterial sid='"+this.sid+"'>\n"),n+=G(this.material,e+1,"material ")},e}(),v=function(){function e(){this.sid=null,this.light=null,this.name=null,this.sidChildren=[]}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<instanceLight>\n"),n+=G(this.light,e+1,"light ")},e}(),_=function(){function e(){this.sid=null,this.camera=null,this.name=null,this.sidChildren=[]}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<instanceCamera>\n"),n+=G(this.light,e+1,"camera ")},e}(),m=function(){function e(){this.id=null,this.initFrom=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<image id='"+this.id+"'>\n"),n+=G(this.initFrom,e+1,"initFrom ")},e}(),l=function(){function e(){this.id=null,this.sids={},this.technique=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<effect id='"+this.id+"'>\n"),n+=G(this.technique,e+1,"technique ")},e}(),c=function(){function e(){this.sid=null,this.sids={},this.fxScope=null,this.shading=null,this.emission=null,this.ambient=null,this.diffuse=null,this.specular=null,this.shininess=null,this.reflective=null,this.transparent=null,this.bump=null,this.reflectivity=null,this.transparency=null,this.index_of_refraction=null}return e.prototype.getInfo=function(e,t){return F(e,t+"<technique sid='"+this.sid+"'>\n")},e}(),u=function(){function e(){this.sid=null,this.fxScope=null,this.type=null,this.initFrom=null,this.format=null,this.size=null,this.viewportRatio=null,this.mipLevels=null,this.mipmapGenerate=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<surface sid='"+this.sid+"'>\n"),n+=G(this.initFrom,e+1,"initFrom ")},e}(),h=function(){function e(){this.sid=null,this.fxScope=null,this.surface=null,this.image=null,this.wrapS=null,this.wrapT=null,this.minfilter=null,this.magfilter=null,this.borderColor=null,this.mipmapMaxLevel=null,this.mipmapBias=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<sampler sid='"+this.sid+"'>\n"),n+=G(this.image,e+1,"image "),n+=G(this.surface,e+1,"surface ")},e}(),s=function(){function e(){this.color=null,this.textureSampler=null,this.texcoord=null,this.opaque=null,this.bumptype=null}return e}(),C=function(){function e(){this.id=null,this.name=null,this.effect=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<material id='"+this.id+"' name='"+this.name+"'>\n"),n+=G(this.effect,e+1,"effect ")},e}(),f=function(){function e(){this.id=null,this.name=null,this.sources=[],this.vertices=null,this.triangles=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s,o,l,h,u;for(n=F(e,t+"<geometry id='"+this.id+"' name='"+this.name+"'>\n"),h=this.sources,a=0,o=h.length;a<o;a++)r=h[a],n+=G(r,e+1,"source ");for(n+=G(this.vertices,e+1,"vertices "),u=this.triangles,s=0,l=u.length;s<l;s++)i=u[s],n+=G(i,e+1,"triangles ");return n},e}(),I=function(){function e(){this.id=null,this.name=null,this.sourceId=null,this.count=null,this.stride=null,this.data=null,this.params={}}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<source id='"+this.id+"' name='"+this.name+"'>\n"),n+=G(this.sourceId,e+1,"sourceId ")},e}(),j=function(){function e(){this.id=null,this.name=null,this.inputs=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s;for(r=F(e,t+"<vertices id='"+this.id+"' name='"+this.name+"'>\n"),s=this.inputs,i=0,a=s.length;i<a;i++)n=s[i],r+=G(n,e+1,"input ");return r},e}(),L=function(){function e(){this.name=null,this.count=null,this.material=null,this.inputs=[],this.indices=null}return e.prototype.getInfo=function(e,t){var n,r,i,a,s;for(r=F(e,t+"<triangles name='"+this.name+"'>\n"),r+=G(this.material,e+1,"material "),s=this.inputs,i=0,a=s.length;i<a;i++)n=s[i],r+=G(n,e+1,"input ");return r},e}(),g=function(){function e(){this.semantic=null,this.source=null,this.offset=null,this.set=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<input semantic="+this.semantic+">\n"),n+=G(this.source,e+1,"source ")},e}(),o=function(){function e(){this.id=null,this.name=null,this.skin=null,this.morph=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<controller id='"+this.id+"', name='"+this.name+"'>\n"),n+=G(this.skin,e+1,"skin "),n+=G(this.morph,e+1,"morph ")},e}(),S=function(){function e(){this.source=null,this.bindShapeMatrix=null,this.sources=[],this.joints=null,this.vertexWeights=null}return e.prototype.getInfo=function(e,t){var n,r,i,a,s;for(n=F(e,t+"<skin source='"+this.source+"'>\n"),n+=G(this.bindShapeMatrix,e+1,"bind_shape_matrix "),s=this.sources,i=0,a=s.length;i<a;i++)r=s[i],n+=G(r,e+1,"source ");return n+=G(this.joints,e+1,"joints "),n+=G(this.vertexWeights,e+1,"vertex_weights ")},e}(),T=function(){function e(){this.joints=null,this.invBindMatrices=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<joints>\n"),n+=G(this.joints,e+1,"joints "),n+=G(this.invBindMatrices,e+1,"invBindMatrices ")},e}(),R=function(){function e(){this.inputs=[],this.vcount=null,this.v=null,this.joints=null,this.weights=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<vertex_weights>\n"),n+=G(this.joints,e+1,"joints "),n+=G(this.weights,e+1,"weights ")},e}(),e=function(){function e(){this.id=null,this.name=null,this.parent=null,this.rootId=null,this.rootName=null,this.animations=[],this.sources=[],this.samplers=[],this.channels=[]}return e.prototype.getInfo=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d,f,m,g,_,y;for(i=F(e,t+"<animation id='"+this.id+"', name='"+name+"'>\n"),m=this.animations,o=0,c=m.length;o<c;o++)n=m[o],i+=G(n,e+1,"animation ");for(g=this.sources,l=0,p=g.length;l<p;l++)s=g[l],i+=G(s,e+1,"source ");for(_=this.samplers,h=0,d=_.length;h<d;h++)a=_[h],i+=G(a,e+1,"sampler ");for(y=this.channels,u=0,f=y.length;u<f;u++)r=y[u],i+=G(r,e+1,"channel ");return i},e}(),N=function(){function e(){this.id=null,this.input=null,this.outputs=[],this.inTangents=[],this.outTangents=[],this.interpolation=null}return e.prototype.getInfo=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d;for(r=F(e,t+"<sampler id='"+this.id+"'>\n"),r+=G(this.input,e+1,"input "),c=this.outputs,a=0,l=c.length;a<l;a++)n=c[a],r+=G(n,e+1,"output ");for(p=this.inTangents,s=0,h=p.length;s<h;s++)i=p[s],r+=G(i,e+1,"inTangent ");for(d=this.outTangents,o=0,u=d.length;o<u;o++)i=d[o],r+=G(i,e+1,"outTangent ");return r+=G(this.interpolation,e+1,"interpolation ")},e}(),a=function(){function e(){this.animation=null,this.source=null,this.target=null}return e.prototype.getInfo=function(e,t){var n;return n=F(e,t+"<channel>\n"),n+=G(this.source,e+1,"source "),n+=G(this.target,e+1,"target ")},e}(),x=function(){function e(){this.id=null,this.name=null,this.type=null,this.color=null,this.params={},this.sidChildren=[]}return e.prototype.getInfo=function(e,t){return F(e,t+"<light>\n")},e}(),w=function(){function e(){this.sid=null,this.name=null,this.value=null}return e}(),r=function(){function e(){this.id=null,this.name=null,this.type=null,this.params={},this.sidChildren=[]}return e.prototype.getInfo=function(e,t){return F(e,t+"<camera>\n")},e}(),i=function(){function e(){this.sid=null,this.name=null,this.value=null}return e}(),V=function(){function e(){this.inputData=null,this.outputData=null,this.offset=null,this.stride=null,this.count=null,this.animation=null}return e}(),q=function(){function e(){this.index=null,this.node=null,this.sid=null,this.parent=null,this.isAnimated=null,this.matrix=new THREE.Matrix4,this.worldMatrix=new THREE.Matrix4,this.invBindMatrix=new THREE.Matrix4,this.skinMatrix=new THREE.Matrix4,this.worldMatrixDirty=!0}return e.prototype.getWorldMatrix=function(){return this.worldMatrixDirty&&(null!=this.parent?this.worldMatrix.multiplyMatrices(this.parent.getWorldMatrix(),this.matrix):this.worldMatrix.copy(this.matrix),this.worldMatrixDirty=!1),this.worldMatrix},e.prototype.applyAnimation=function(e){var t,n,r,i;if(this.isAnimated){for(i=this.node.transformations,n=0,r=i.length;n<r;n++)t=i[n],t.applyAnimationKeyframe(e);this.node.getTransformMatrix(this.matrix)}return this.worldMatrixDirty=!0,null},e.prototype.updateSkinMatrix=function(e){var t;return t=this.getWorldMatrix(),this.skinMatrix.multiplyMatrices(t,this.invBindMatrix),this.skinMatrix.multiplyMatrices(this.skinMatrix,e),null},e}(),W=function(){function e(){this.materials=[],this.indices={},this.needTangents=!1}return e}(),p=function(){function p(e){var t,n,r;this._url=null,this._baseUrl=null,this._loader=e,this._options={},r=e.options;for(t in r)n=r[t],this._options[t]=n;this._log=e.log,this._readyCallback=null,this._progressCallback=null,this.dae={},this.dae.ids={},this.dae.animationTargets=[],this.dae.libEffects=[],this.dae.libMaterials=[],this.dae.libGeometries=[],this.dae.libControllers=[],this.dae.libLights=[],this.dae.libCameras=[],this.dae.libImages=[],this.dae.libVisualScenes=[],this.dae.libAnimations=[],this.dae.asset=null,this.dae.scene=null,this.threejs={},this.threejs.scene=null,this.threejs.images=[],this.threejs.geometries=[],this.threejs.materials=[],this.scene=null}return p.prototype.setUrl=function(e){var t;null!=e?(this._url=e,t=e.split("/"),t.pop(),this._baseUrl=(t.length<1?".":t.join("/"))+"/"):(this._url="",this._baseUrl="")},p.prototype.getLibInfo=function(e,t,n){var r,i,a,s,o;if(null==e)return"";for(a=F(t,n+" <"+n+">\n"),i=0,s=0,o=e.length;s<o;s++)r=e[s],a+=G(r,t+1,""),i+=1;return i>0?a:""},p.prototype.getInfo=function(e,t){var n;return n="<collada url='"+this.url+"'>\n",n+=G(this.dae.asset,e+1,"asset "),n+=G(this.dae.scene,e+1,"scene "),n+=this.getLibInfo(this.dae.libEffects,e+1,"library_effects"),n+=this.getLibInfo(this.dae.libMaterials,e+1,"library_materials"),n+=this.getLibInfo(this.dae.libGeometries,e+1,"library_geometries"),n+=this.getLibInfo(this.dae.libControllers,e+1,"library_controllers"),n+=this.getLibInfo(this.dae.libLights,e+1,"library_lights"),n+=this.getLibInfo(this.dae.libCameras,e+1,"library_cameras"),n+=this.getLibInfo(this.dae.libImages,e+1,"library_images"),n+=this.getLibInfo(this.dae.libVisualScenes,e+1,"library_visual_scenes"),n+=this.getLibInfo(this.dae.libAnimations,e+1,"library_animations")},p.prototype._reportUnexpectedChild=function(e,t){this._log("Skipped unknown <"+e.nodeName+"> child <"+t.nodeName+">.",E.messageWarning)},p.prototype._reportUnhandledExtra=function(e,t){this._log("Skipped element <"+e.nodeName+">/<"+t.nodeName+">. Element is legal, but not handled by this loader.",E.messageWarning)},p.prototype._getAttributeAsFloat=function(e,t,n){var r;return r=e.getAttribute(t),null!=r?parseFloat(r):n},p.prototype._getAttributeAsInt=function(e,t,n){var r;return r=e.getAttribute(t),null!=r?parseInt(r,10):n},p.prototype._addUrlTarget=function(e,t,n){var r;return null!=t&&t.push(e),null==(r=e.id)?void(n&&this._log("Object has no ID.",E.messageError)):null!=this.dae.ids[r]?void this._log("There is already an object with ID "+r+".",E.messageError):void(this.dae.ids[r]=e)},p.prototype._resolveUrlLink=function(e){return e.object=this.dae.ids[e.url],null!=e.object||(this._log("Could not resolve URL #"+e.url,E.messageError),!1)},p.prototype._addFxTarget=function(e,t){var n;return null==(n=e.sid)?void this._log("Cannot add a FX target: object has no SID.",E.messageError):null!=t.sids[n]?void this._log("There is already an FX target with SID "+n+".",E.messageError):(e.fxScope=t,void(t.sids[n]=e))},p.prototype._resolveFxLink=function(e){var t;for(t=e.scope;null==e.object&&null!=t;)e.object=t.sids[e.url],t=t.fxScope;return null!=e.object||(this._log("Could not resolve FX parameter #"+e.url,E.messageError),!1)},p.prototype._addSidTarget=function(e,t){null==t.sidChildren&&(t.sidChildren=[]),t.sidChildren.push(e)},p.prototype._findSidTarget=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d;for(l=t.split("/"),i=e,n=null,h=0,c=l.length;h<c;h++){for(s=l[h],a=[i];0!==a.length;){if(r=a.shift(),r.sid===s){n=r;break}if(null!=r.sidChildren)for(d=r.sidChildren,u=0,p=d.length;u<p;u++)o=d[u],a.push(o)}if(null==n)return null;i=n}return n},p.prototype._resolveSidLink=function(e){var t,n,r,i,a,s,o,l,h,u,c,p,d;if(null==(t=this.dae.ids[e.id]))return this._log("Could not resolve SID #"+e.url+", missing base ID "+e.id,E.messageError),!1;for(i=t,n=null,p=e.sids,l=0,u=p.length;l<u;l++){for(s=p[l],a=[i];0!==a.length;){if(r=a.shift(),r.sid===s){n=r;break}if(null!=r.sidChildren)for(d=r.sidChildren,h=0,c=d.length;h<c;h++)o=d[h],a.push(o)}if(null==n)return this._log("Could not resolve SID #"+e.url+", missing SID part "+s,E.messageError),!1;i=n}return e.object=n,!0},p.prototype._getLinkTarget=function(e,t){return null==e?null:(null==e.object&&(e instanceof U?this._resolveUrlLink(e):e instanceof M?this._resolveSidLink(e):e instanceof d?this._resolveFxLink(e):this._log("Trying to resolve an object that is not a link",E.messageError)),null==t||null==e.object||e.object instanceof t||this._log("Link "+e.url+" does not link to a "+t.name,E.messageError),e.object)},p.prototype._parseXml=function(e){var t,n;t=e.childNodes[0],"COLLADA"===(null!=t&&null!=(n=t.nodeName)?n.toUpperCase():void 0)?this._parseCollada(t):this._log("Can not parse document, top level element is not <COLLADA>.",E.messageError)},p.prototype._parseCollada=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"asset":this._parseAsset(t);break;case"scene":this._parseScene(t);break;case"library_effects":this._parseLibEffect(t);break;case"library_materials":this._parseLibMaterial(t);break;case"library_geometries":this._parseLibGeometry(t);break;case"library_images":this._parseLibImage(t);break;case"library_visual_scenes":this._parseLibVisualScene(t);break;case"library_controllers":this._parseLibController(t);break;case"library_animations":this._parseLibAnimation(t);break;case"library_lights":this._parseLibLight(t);break;case"library_cameras":this._parseLibCamera(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseAsset=function(e){var t,r,i,a;for(this.dae.asset||(this.dae.asset=new n),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"unit":this.dae.asset.unit=this._getAttributeAsFloat(t,"meter");break;case"up_axis":this.dae.asset.upAxis=t.textContent.toUpperCase().charAt(0);break;case"contributor":case"created":case"modified":case"revision":case"title":case"subject":case"keywords":break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseScene=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"instance_visual_scene":this.dae.scene=new U(t.getAttribute("url"));break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseLibVisualScene=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"visual_scene":this._parseVisualScene(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseVisualScene=function(e){var t,n,r,i,a;for(n=new H,n.id=e.getAttribute("id"),this._addUrlTarget(n,this.dae.libVisualScenes,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"node":this._parseSceneNode(n,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseSceneNode=function(e,t){var n,r,i,a,s;for(r=new O,r.id=t.getAttribute("id"),r.sid=t.getAttribute("sid"),r.name=t.getAttribute("name"),r.type=t.getAttribute("type"),r.layer=t.getAttribute("layer"),r.parent=e,e.children.push(r),this._addUrlTarget(r,null,!1),this._addSidTarget(r,e),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"instance_geometry":this._parseInstanceGeometry(r,n);break;case"instance_controller":this._parseInstanceController(r,n);break;case"instance_light":this._parseInstanceLight(r,n);break;case"instance_camera":this._parseInstanceCamera(r,n);break;case"matrix":case"rotate":case"translate":case"scale":this._parseTransformElement(r,n);break;case"node":this._parseSceneNode(r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseInstanceGeometry=function(e,t){var n,r,i,a,s;for(r=new b,r.geometry=new U(t.getAttribute("url")),r.sid=t.getAttribute("sid"),e.geometries.push(r),this._addSidTarget(r,e),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"bind_material":this._parseBindMaterial(r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseInstanceController=function(e,t){var n,r,i,a,s;for(r=new y,r.controller=new U(t.getAttribute("url")),r.sid=t.getAttribute("sid"),r.name=t.getAttribute("name"),e.controllers.push(r),this._addSidTarget(r,e),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"skeleton":r.skeletons.push(new U(n.textContent));break;case"bind_material":this._parseBindMaterial(r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseBindMaterial=function(e,t){var n,r,i,a;for(a=t.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"technique_common":this._parseBindMaterialTechnique(e,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseBindMaterialTechnique=function(e,t){var n,r,i,a;for(a=t.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"instance_material":this._parseInstanceMaterial(e,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseInstanceMaterial=function(e,t){var n,r,i,a,s,o,l,h,u;for(a=new k,a.symbol=t.getAttribute("symbol"),a.material=new U(t.getAttribute("target")),e.materials.push(a),this._addSidTarget(a,e),u=t.childNodes,l=0,h=u.length;l<h;l++)if(n=u[l],1===n.nodeType)switch(n.nodeName){case"bind_vertex_input":s=n.getAttribute("semantic"),r=n.getAttribute("input_semantic"),i=n.getAttribute("input_set"),null!=i&&(i=parseInt(i,10)),a.vertexInputs[s]={inputSemantic:r,inputSet:i};break;case"bind":s=n.getAttribute("semantic"),o=new M(null,n.getAttribute("target")),a.params[s]={target:o};break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseTransformElement=function(e,t){var n,r;switch(r=new A,r.sid=t.getAttribute("sid"),r.type=t.nodeName,r.node=e,e.transformations.push(r),this._addSidTarget(r,e),this.dae.animationTargets.push(r),r.data=Q(t.textContent),n=0,r.type){case"matrix":n=16;break;case"rotate":n=4;break;case"translate":case"scale":n=3;break;case"skew":n=7;break;case"lookat":n=9;break;default:this._log("Unknown transformation type "+r.type+".",E.messageError)}r.data.length!==n&&this._log("Wrong number of elements for transformation type '"+r.type+"': expected "+n+", found "+r.data.length,E.messageError)},p.prototype._parseInstanceLight=function(e,t){var n,r,i,a,s;for(r=new v,r.light=new U(t.getAttribute("url")),r.sid=t.getAttribute("sid"),r.name=t.getAttribute("name"),e.lights.push(r),this._addSidTarget(r,e),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"extra":this._reportUnhandledExtra(t,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseInstanceCamera=function(e,t){var n,r,i,a,s;for(n=new _,n.camera=new U(t.getAttribute("url")),n.sid=t.getAttribute("sid"),n.name=t.getAttribute("name"),e.cameras.push(n),this._addSidTarget(n,e),s=t.childNodes,i=0,a=s.length;i<a;i++)if(r=s[i],1===r.nodeType)switch(r.nodeName){case"extra":this._reportUnhandledExtra(t,r);break;default:this._reportUnexpectedChild(t,r)}},p.prototype._parseLibEffect=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"effect":this._parseEffect(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseEffect=function(e){var t,n,r,i,a;for(n=new l,n.id=e.getAttribute("id"),this._addUrlTarget(n,this.dae.libEffects,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"profile_COMMON":this._parseEffectProfileCommon(n,t);break;case"profile":this._log("Skipped non-common effect profile for effect "+n.id+".",E.messageWarning);break;case"extra":break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseEffectProfileCommon=function(e,t){var n,r,i,a;for(a=t.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"newparam":this._parseEffectNewparam(e,n);break;case"technique":this._parseEffectTechnique(e,n);break;case"extra":this._parseTechniqueExtra(e.technique,"COMMON",n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseEffectNewparam=function(e,t){var n,r,i,a,s;for(r=t.getAttribute("sid"),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"surface":this._parseEffectSurface(e,r,n);break;case"sampler2D":this._parseEffectSampler(e,r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseEffectSurface=function(e,t,n){var r,i,a,s,o;for(i=new u,i.type=n.getAttribute("type"),i.sid=t,this._addFxTarget(i,e),o=n.childNodes,a=0,s=o.length;a<s;a++)if(r=o[a],1===r.nodeType)switch(r.nodeName){case"init_from":i.initFrom=new U(r.textContent);break;case"format":i.format=r.textContent;break;case"size":i.size=Q(r.textContent);break;case"viewport_ratio":i.viewportRatio=Q(r.textContent);break;case"mip_levels":i.mipLevels=parseInt(r.textContent,10);break;case"mipmap_generate":i.mipmapGenerate=r.textContent;break;default:this._reportUnexpectedChild(n,r)}},p.prototype._parseEffectSampler=function(e,t,n){var r,i,a,s,o;for(i=new h,i.sid=t,this._addFxTarget(i,e),o=n.childNodes,a=0,s=o.length;a<s;a++)if(r=o[a],1===r.nodeType)switch(r.nodeName){case"source":i.surface=new d(r.textContent,e);break;case"instance_image":i.image=new U(r.getAttribute("url"));break;case"wrap_s":i.wrapS=r.textContent;break;case"wrap_t":i.wrapT=r.textContent;break;case"minfilter":i.minfilter=r.textContent;break;case"magfilter":i.magfilter=r.textContent;break;case"border_color":i.borderColor=Q(r.textContent);break;case"mipmap_maxlevel":i.mipmapMaxLevel=parseInt(r.textContent,10);break;case"mipmap_bias":i.mipmapBias=parseFloat(r.textContent);break;default:this._reportUnexpectedChild(n,r)}},p.prototype._parseEffectTechnique=function(e,t){var n,r,i,a,s;for(r=new c,r.sid=t.getAttribute("sid"),this._addFxTarget(r,e),e.technique=r,s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"blinn":case"phong":case"lambert":case"constant":r.shading=n.nodeName,this._parseTechniqueParam(r,"COMMON",n);break;case"extra":this._parseTechniqueExtra(r,"COMMON",n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseTechniqueParam=function(e,t,n){var r,i,a,s;for(s=n.childNodes,i=0,a=s.length;i<a;i++)if(r=s[i],1===r.nodeType)switch(r.nodeName){case"newparam":this._parseEffectNewparam(e,r);break;case"emission":case"ambient":case"diffuse":case"specular":case"reflective":this._parseEffectColorOrTexture(e,r);break;case"shininess":case"reflectivity":case"transparency":case"index_of_refraction":e[r.nodeName]=parseFloat(r.childNodes[1].textContent);break;case"transparent":this._parseEffectColorOrTexture(e,r),e.transparent.opaque=r.getAttribute("opaque");break;case"bump":this._parseEffectColorOrTexture(e,r),e.bump.bumptype=r.getAttribute("bumptype");break;case"double_sided":e.doubleSided=1===parseInt(r.textContent,10);break;default:"COMMON"===t&&this._reportUnexpectedChild(n,r)}},p.prototype._parseTechniqueExtra=function(e,t,n){var r,i,a,s;for(s=n.childNodes,i=0,a=s.length;i<a;i++)if(r=s[i],1===r.nodeType)switch(r.nodeName){case"technique":t=r.getAttribute("profile"),this._parseTechniqueParam(e,t,r);break;default:this._reportUnexpectedChild(n,r)}},p.prototype._parseEffectColorOrTexture=function(e,t){var n,r,i,a,o,l,h;for(i=t.nodeName,r=e[i],null==r&&(r=new s,e[i]=r),h=t.childNodes,o=0,l=h.length;o<l;o++)if(n=h[o],1===n.nodeType)switch(n.nodeName){case"color":r.color=K(n.textContent);break;case"texture":a=n.getAttribute("texture"),r.textureSampler=new d(a,e),r.texcoord=n.getAttribute("texcoord");break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseLibMaterial=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"material":this._parseMaterial(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseMaterial=function(e){var t,n,r,i,a;for(n=new C,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),this._addUrlTarget(n,this.dae.libMaterials,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"instance_effect":n.effect=new U(t.getAttribute("url"));break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseLibGeometry=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"geometry":this._parseGeometry(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseGeometry=function(e){var t,n,r,i,a;for(n=new f,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),this._addUrlTarget(n,this.dae.libGeometries,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"mesh":this._parseMesh(n,t);break;case"convex_mesh":case"spline":this._log("Geometry type "+t.nodeName+" not supported.",E.messageError);break;case"extra":this._parseGeometryExtra(n,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseMesh=function(e,t){var n,r,i,a;for(a=t.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"source":this._parseSource(e,n);break;case"vertices":this._parseVertices(e,n);break
;case"triangles":case"polylist":case"polygons":this._parseTriangles(e,n);break;case"lines":case"linestrips":case"trifans":case"tristrips":this._log("Geometry primitive type "+n.nodeName+" not supported.",E.messageError);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseGeometryExtra=function(e,t){var n,r,i,a,s;for(s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"technique":r=n.getAttribute("profile"),this._parseGeometryExtraTechnique(e,r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseGeometryExtraTechnique=function(e,t,n){var r,i,a,s;for(s=n.childNodes,i=0,a=s.length;i<a;i++)if(r=s[i],1===r.nodeType)switch(r.nodeName){case"double_sided":e.doubleSided="1"===n.textContent}},p.prototype._parseSource=function(e,t){var n,r,i,a,s;for(r=new I,r.id=t.getAttribute("id"),r.name=t.getAttribute("name"),this._addUrlTarget(r,e.sources,!0),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"bool_array":r.sourceId=n.getAttribute("id"),r.data=J(n.textContent);break;case"float_array":r.sourceId=n.getAttribute("id"),r.data=Q(n.textContent);break;case"int_array":r.sourceId=n.getAttribute("id"),r.data=Y(n.textContent);break;case"IDREF_array":case"Name_array":r.sourceId=n.getAttribute("id"),r.data=Z(n.textContent);break;case"technique_common":this._parseSourceTechniqueCommon(r,n);break;case"technique":break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseVertices=function(e,t){var n,r,i,a,s;for(r=new j,r.id=t.getAttribute("id"),r.name=t.getAttribute("name"),this._addUrlTarget(r,null,!0),e.vertices=r,s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"input":r.inputs.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseTriangles=function(e,t){var n,r,i,a,s;for(r=new L,r.name=t.getAttribute("name"),r.material=t.getAttribute("material"),r.count=this._getAttributeAsInt(t,"count"),r.type=t.nodeName,e.triangles.push(r),s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"input":r.inputs.push(this._parseInput(n));break;case"vcount":r.vcount=Y(n.textContent);break;case"p":r.indices=Y(n.textContent);break;default:this._reportUnexpectedChild(t,n)}return r},p.prototype._parseSourceTechniqueCommon=function(e,t){var n,r,i,a;for(a=t.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"accessor":this._parseAccessor(e,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseAccessor=function(e,t){var n,r,i,a,s,o,l;for(i=t.getAttribute("source"),e.count=t.getAttribute("count"),e.stride=this._getAttributeAsInt(t,"stride",1),i!=="#"+e.sourceId&&this._log("Non-local sources not supported, source data will be empty",E.messageError),l=t.childNodes,s=0,o=l.length;s<o;s++)if(n=l[s],1===n.nodeType)switch(n.nodeName){case"param":r=n.getAttribute("name"),a=n.getAttribute("type"),e.params[r]=a;break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseInput=function(e){var t;return t=new g,t.semantic=e.getAttribute("semantic"),t.source=new U(e.getAttribute("source")),t.offset=this._getAttributeAsInt(e,"offset"),t.set=this._getAttributeAsInt(e,"set"),t},p.prototype._parseLibImage=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"image":this._parseImage(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseImage=function(e){var t,n,r,i,a;for(n=new m,n.id=e.getAttribute("id"),this._addUrlTarget(n,this.dae.libImages,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"init_from":n.initFrom=t.textContent;break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseLibController=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"controller":this._parseController(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseController=function(e){var t,n,r,i,a;for(n=new o,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),this._addUrlTarget(n,this.dae.libControllers,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"skin":this._parseSkin(n,t);break;case"morph":this._parseMorph(n,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseMorph=function(e,t){this._log("Morph controllers not implemented",E.messageError)},p.prototype._parseSkin=function(e,t){var n,r,i,a,s;for(r=new S,r.source=new U(t.getAttribute("source")),null==e.skin&&null==e.morph||this._log("Controller already has a skin or morph",E.messageError),e.skin=r,s=t.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":this._parseBindShapeMatrix(r,n);break;case"source":this._parseSource(r,n);break;case"joints":this._parseJoints(r,n);break;case"vertex_weights":this._parseVertexWeights(r,n);break;default:this._reportUnexpectedChild(t,n)}},p.prototype._parseBindShapeMatrix=function(e,t){e.bindShapeMatrix=Q(t.textContent)},p.prototype._parseJoints=function(e,t){var n,r,i,a,s,o,l,h,u;for(a=new T,null!=e.joints&&this._log("Skin already has a joints array",E.messageError),e.joints=a,i=[],u=t.childNodes,s=0,l=u.length;s<l;s++)if(n=u[s],1===n.nodeType)switch(n.nodeName){case"input":i.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}for(o=0,h=i.length;o<h;o++)switch(r=i[o],r.semantic){case"JOINT":a.joints=r;break;case"INV_BIND_MATRIX":a.invBindMatrices=r;break;default:this._log("Unknown joints input semantic "+r.semantic,E.messageError)}},p.prototype._parseVertexWeights=function(e,t){var n,r,i,a,s,o,l,h,u;for(a=new R,a.count=parseInt(t.getAttribute("count"),10),null!=e.vertexWeights&&this._log("Skin already has a vertex weight array",E.messageError),e.vertexWeights=a,i=[],u=t.childNodes,s=0,l=u.length;s<l;s++)if(n=u[s],1===n.nodeType)switch(n.nodeName){case"input":i.push(this._parseInput(n));break;case"vcount":a.vcount=Y(n.textContent);break;case"v":a.v=Y(n.textContent);break;default:this._reportUnexpectedChild(t,n)}for(o=0,h=i.length;o<h;o++)switch(r=i[o],r.semantic){case"JOINT":a.joints=r;break;case"WEIGHT":a.weights=r;break;default:this._log("Unknown vertex weight input semantic "+r.semantic,E.messageError)}},p.prototype._parseLibAnimation=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"animation":this._parseAnimation(null,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseAnimation=function(t,n){var r,i,a,s,o;for(r=new e,r.id=n.getAttribute("id"),r.name=n.getAttribute("name"),r.parent=t,null!=t?(r.rootId=t.rootId,r.rootName=t.rootName):(r.rootId=r.id,r.rootName=r.name),this._addUrlTarget(r,(null!=t?t.animations:void 0)||this.dae.libAnimations,!1),o=n.childNodes,a=0,s=o.length;a<s;a++)if(i=o[a],1===i.nodeType)switch(i.nodeName){case"animation":this._parseAnimation(r,i);break;case"source":this._parseSource(r,i);break;case"sampler":this._parseSampler(r,i);break;case"channel":this._parseChannel(r,i);break;default:this._reportUnexpectedChild(n,i)}},p.prototype._parseSampler=function(e,t){var n,r,i,a,s,o,l,h,u;for(a=new N,a.id=t.getAttribute("id"),null!=a.id&&this._addUrlTarget(a,e.samplers,!1),i=[],u=t.childNodes,s=0,l=u.length;s<l;s++)if(n=u[s],1===n.nodeType)switch(n.nodeName){case"input":i.push(this._parseInput(n));break;default:this._reportUnexpectedChild(t,n)}for(o=0,h=i.length;o<h;o++)switch(r=i[o],r.semantic){case"INPUT":a.input=r;break;case"OUTPUT":a.outputs.push(r);break;case"INTERPOLATION":a.interpolation=r;break;case"IN_TANGENT":a.inTangents.push(r);break;case"OUT_TANGENT":a.outTangents.push(r);break;default:this._log("Unknown sampler input semantic "+r.semantic,E.messageError)}},p.prototype._parseChannel=function(e,t){var n,r,i,s,o;for(n=new a,n.source=new U(t.getAttribute("source")),n.target=new M(e.id,t.getAttribute("target")),e.channels.push(n),n.animation=e,o=t.childNodes,i=0,s=o.length;i<s;i++)r=o[i],1===r.nodeType&&this._reportUnexpectedChild(t,r)},p.prototype._parseLibLight=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"light":this._parseLight(t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseLight=function(e){var t,n,r,i,a;for(n=new x,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),null!=n.id&&this._addUrlTarget(n,this.dae.libLights,!0),a=e.childNodes,r=0,i=a.length;r<i;r++)if(t=a[r],1===t.nodeType)switch(t.nodeName){case"technique_common":this._parseLightTechniqueCommon(t,n);break;case"extra":this._reportUnhandledExtra(e,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseLightTechniqueCommon=function(e,t){var n,r,i,a;for(a=e.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"ambient":case"directional":case"point":case"spot":this._parseLightParams(n,"COMMON",t);break;default:this._reportUnexpectedChild(e,n)}},p.prototype._parseLightParams=function(e,t,n){var r,i,a,s;for(n.type=e.nodeName,s=e.childNodes,i=0,a=s.length;i<a;i++)if(r=s[i],1===r.nodeType)switch(r.nodeName){case"color":this._parseLightColor(r,t,n);break;case"constant_attenuation":case"linear_attenuation":case"quadratic_attenuation":case"falloff_angle":case"falloff_exponent":this._parseLightParam(r,t,n);break;default:this._reportUnexpectedChild(e,r)}},p.prototype._parseLightColor=function(e,t,n){n.color=Q(e.textContent)},p.prototype._parseLightParam=function(e,t,n){var r;r=new w,r.sid=e.getAttribute("sid"),r.name=e.nodeName,n.params[r.name]=r,this._addSidTarget(r,n),r.value=parseFloat(e.textContent)},p.prototype._parseLibCamera=function(e){var t,n,r,i;for(i=e.childNodes,n=0,r=i.length;n<r;n++)if(t=i[n],1===t.nodeType)switch(t.nodeName){case"camera":this._parseCamera(t);break;case"extra":this._reportUnhandledExtra(e,t);break;default:this._reportUnexpectedChild(e,t)}},p.prototype._parseCamera=function(e){var t,n,i,a,s;for(t=new r,t.id=e.getAttribute("id"),null!=t.id&&this._addUrlTarget(t,this.dae.libCameras,!0),t.name=e.getAttribute("name"),s=e.childNodes,i=0,a=s.length;i<a;i++)if(n=s[i],1===n.nodeType)switch(n.nodeName){case"asset":this._reportUnhandledExtra(e,n);break;case"optics":this._parseCameraOptics(n,t);break;case"imager":case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}},p.prototype._parseCameraOptics=function(e,t){var n,r,i,a;for(a=e.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"technique_common":this._parseCameraTechniqueCommon(n,t);break;case"technique":case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}},p.prototype._parseCameraTechniqueCommon=function(e,t){var n,r,i,a;for(a=e.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"orthographic":case"perspective":this._parseCameraParams(n,t);break;default:this._reportUnexpectedChild(e,n)}},p.prototype._parseCameraParams=function(e,t){var n,r,i,a;for(t.type=e.nodeName,a=e.childNodes,r=0,i=a.length;r<i;r++)if(n=a[r],1===n.nodeType)switch(n.nodeName){case"xmag":case"ymag":case"xfov":case"yfov":case"aspect_ratio":case"znear":case"zfar":this._parseCameraParam(n,t);break;case"extra":this._reportUnhandledExtra(e,n);break;default:this._reportUnexpectedChild(e,n)}},p.prototype._parseCameraParam=function(e,t){var n;n=new i,n.sid=e.getAttribute("sid"),n.name=e.nodeName,t.params[n.name]=n,this._addSidTarget(n,t),n.value=parseFloat(e.textContent)},p.prototype._linkAnimations=function(){var e,t,n,r,i,a,s,o;for(s=this.dae.animationTargets,n=0,i=s.length;n<i;n++)t=s[n],t.initAnimationTarget();for(o=this.dae.libAnimations,r=0,a=o.length;r<a;r++)e=o[r],this._linkAnimationChannels(e)},p.prototype._linkAnimationChannels=function(e){var n,r,i,a,s,o,l,h,u,c,p,d,f,m,g;for(f=e.channels,u=0,p=f.length;u<p;u++)if(n=f[u],null!=(l=this._getLinkTarget(n.target,t)))if(null!=(o=this._getLinkTarget(n.source,N)))if(null!=(i=this._getLinkTarget(null!=(m=o.input)?m.source:void 0)))if(0!==o.outputs.length)if(o.outputs.length>1&&this._log("Animation channel has more than one output, using only the first output",E.messageWarning),a=o.outputs[0],null!=(s=this._getLinkTarget(null!=a?a.source:void 0))){if(h=new V,h.outputData=s.data,h.inputData=i.data,h.stride=s.stride,h.animation=e,n.target.dotSyntax)switch(h.semantic=n.target.member,h.count=1,h.semantic){case"X":h.offset=0;break;case"Y":h.offset=1;break;case"Z":h.offset=2;break;case"W":h.offset=3;break;case"R":h.offset=0;break;case"G":h.offset=1;break;case"B":h.offset=2;break;case"U":h.offset=0;break;case"V":h.offset=1;break;case"S":h.offset=0;break;case"T":h.offset=1;break;case"P":h.offset=2;break;case"Q":case"ANGLE":h.offset=3;break;default:this._log("Unknown semantic for '"+targetLink.url+"', animation ignored",E.messageWarning);continue}else if(n.target.arrSyntax){switch(targetLink.indices.length){case 1:h.offset=targetLink.indices[0];break;case 2:h.offset=targetLink.indices[0]*l.animTarget.dataRows+targetLink.indices[1];break;default:this._log("Invalid number of indices for '"+targetLink.url+"', animation ignored",E.messageWarning);continue}h.count=1}else h.offset=0,h.count=l.animTarget.dataColumns*l.animTarget.dataRows;l.animTarget.channels.push(h)}else this._log("Animation channel has no output data, animation ignored",E.messageWarning);else this._log("Animation channel has no output, animation ignored",E.messageWarning);else this._log("Animation channel has no input data, animation ignored",E.messageWarning);else this._log("Animation channel has an invalid sampler '"+n.source.url+"', animation ignored",E.messageWarning);else this._log("Animation channel has an invalid target '"+n.target.url+"', animation ignored",E.messageWarning);for(g=e.animations,c=0,d=g.length;c<d;c++)r=g[c],this._linkAnimationChannels(r)},p.prototype._createSceneGraph=function(){var e,t,n,r,i,a;if(null!=(t=this._getLinkTarget(this.dae.scene,H))){for(n=new THREE.Object3D,this.threejs.scene=n,a=t.children,r=0,i=a.length;r<i;r++)e=a[r],this._createSceneGraphNode(e,n);this.scene=n}},p.prototype._setNodeTransformation=function(e,t){e.getTransformMatrix(t.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale),t.rotation.setFromQuaternion(t.quaternion)},p.prototype._createSceneGraphNode=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,C,A,N,M,S;for(h=[],C=e.geometries,d=0,_=C.length;d<_;d++)a=C[d],null!=(c=this._createStaticMesh(a))&&(c.name=null!=e.name?e.name:"",h.push(c));for(A=e.controllers,f=0,y=A.length;f<y;f++)i=A[f],null!=(c=this._createAnimatedMesh(i))&&(c.name=null!=e.name?e.name:"",h.push(c));for(N=e.lights,m=0,b=N.length;m<b;m++)s=N[m],null!=(u=this._createLight(s))&&(u.name=null!=e.name?e.name:"",h.push(u));for(M=e.cameras,g=0,v=M.length;g<v;g++)n=M[g],null!=(o=this._createCamera(n))&&(o.name=null!=e.name?e.name:"",h.push(o));if(h.length>1){for(p=new THREE.Object3D,x=0,k=h.length;x<k;x++)null!=(l=h[x])&&p.add(l);t.add(p)}else 1===h.length?(p=h[0],t.add(p)):0===h.length&&("JOINT"!==e.type&&this._log("Collada node "+e.name+" did not produce any threejs nodes",E.messageWarning),p=new THREE.Object3D,t.add(p));for(this._setNodeTransformation(e,p),S=e.children,w=0,T=S.length;w<T;w++)r=S[w],this._createSceneGraphNode(r,p)},p.prototype._createLight=function(e){var t,n,r,i,a,s,o,l,h,u,c,p;if(null==(o=this._getLinkTarget(e.light,x)))return this._log("Light instance has no light, light ignored",E.messageWarning),null;switch(r=o.color,i=255*r[0]<<16^255*r[1]<<8^255*r[2]<<0,t=null!=(l=o.params.constant_attenuation)?l.value:void 0,n=null!=(h=o.params.linear_attenuation)?h.value:void 0,null!=(u=o.params.quadratic_attenuation)?u.value:void 0,a=null!=(c=o.params.falloff_angle)?c.value:void 0,s=null!=(p=o.params.falloff_exponent)?p.value:void 0,o.type){case"ambient":o=new THREE.AmbientLight(i);break;case"directional":o=new THREE.DirectionalLight(i,1);break;case"point":o=new THREE.PointLight(i,t,n);break;case"spot":o=new THREE.SpotLight(i,t,n,a,s);break;default:this._log("Unknown light type "+e.type+", light ignored.",E.messageError)}return o},p.prototype._createCamera=function(e){var t,n,i,a,s,o,l,h,u,c,p,d,f,m,g;if(null==(n=this._getLinkTarget(e.camera,r)))return this._log("Camera instance has no camera, camera ignored",E.messageWarning),null;switch(a=null!=(u=n.params.xmag)?u.value:void 0,o=null!=(c=n.params.ymag)?c.value:void 0,i=null!=(p=n.params.xfov)?p.value:void 0,s=null!=(d=n.params.yfov)?d.value:void 0,t=null!=(f=n.params.aspect_ratio)?f.value:void 0,h=null!=(m=n.params.znear)?m.value:void 0,l=null!=(g=n.params.zfar)?g.value:void 0,n.type){case"orthographic":null!=a&&null!=o?t=a/o:null!=o&&null!=t?a=o*t:null!=a&&null!=t?o=a/t:null!=a?(t=1,o=a):null!=o?(t=1,a=o):this._log("Not enough field of view parameters for an orthographic camera.",E.messageError),n=new THREE.OrthographicCamera(-a,+a,-o,+o,h,l);break;case"perspective":null!=i&&null!=s?t=i/s:null!=s&&null!=t?i=s*t:null!=i&&null!=t?s=i/t:null!=i?(t=1,s=i):null!=s?(t=1,i=s):this._log("Not enough field of view parameters for a perspective camera.",E.messageError),n=new THREE.PerspectiveCamera(s,t,h,l);break;default:this._log("Unknown camera type "+e.type+", camera ignored.",E.messageError)}return n},p.prototype._createStaticMesh=function(e){var t,n,r,i;return null==(t=this._getLinkTarget(e.geometry,f))?(this._log("Geometry instance has no geometry, mesh ignored",E.messageWarning),null):(i=this._createGeometryAndMaterial(t,e.materials),n=i[0],r=i[1],new THREE.Mesh(n,r))},p.prototype._createGeometryAndMaterial=function(e,t){var n,r,i,a,s,o,l;if(a=this._createMaterials(t),r=this._createGeometry(e,a),i=null,a.materials.length>1)for(i=new THREE.MeshFaceMaterial,l=a.materials,s=0,o=l.length;s<o;s++)n=l[s],i.materials.push(n);else i=a.materials[0];return[r,i]},p.prototype._createAnimatedMesh=function(e,t){return t=this._getLinkTarget(e.controller,o),null!=t.skin?this._createSkinMesh(e,t):null!=t.morph?this._createMorphMesh(e,t):(this._log("Controller has neither a skin nor a morph, can not create a mesh",E.messageError),null)},p.prototype._createSkinMesh=function(e,t){var n,r,i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,C,A,N,M,L,U,R,j;if(null==(s=t.skin)||!(s instanceof S))return this._log("Controller for a skinned mesh has no skin, mesh ignored",E.messageError),null;if(null==(o=this._getLinkTarget(s.source)))return this._log("Skin for a skinned mesh has no geometry, mesh ignored",E.messageError),null;if(!this._options.useAnimations)return A=this._createGeometryAndMaterial(o,e.materials),g=A[0],_=A[1],new THREE.Mesh(g,_);for(m=[],N=e.skeletons,y=0,T=N.length;y<T;y++)f=N[y],d=this._getLinkTarget(f,O),null!=d?m.push(d):this._log("Controller instance for a skinned mesh uses unknown skeleton "+d+", skeleton ignored",E.messageError);if(0===m.length)return this._log("Controller instance for a skinned mesh has no skeleton, mesh ignored",E.messageError),null;if(null==s.joints)return this._log("Skin has no joints, mesh ignored",E.messageError),null;if(null==(a=this._getLinkTarget(null!=(M=s.joints.joints)?M.source:void 0,I))||null==a.data)return this._log("Skin has no joints source, mesh ignored",E.messageError),null;if(null==(i=this._getLinkTarget(null!=(L=s.joints.invBindMatrices)?L.source:void 0,I))||null==i.data)return this._log("Skin has no inverse bind matrix source, mesh ignored",E.messageError),null;if(16*a.data.length!==i.data.length)return this._log("Skin has an inconsistent length of joint data sources, mesh ignored",E.messageError),null;for(r=[],U=a.data,b=0,x=U.length;b<x;b++){if(u=U[b],null==(h=this._findJointNode(u,m)))return this._log("Joint "+u+" not found for skin with skeletons "+m.map(function(e){return e.id}).join(", ")+", mesh ignored",E.messageError),null;n=this._createBone(h,u,r),X(i.data,16*n.index,n.invBindMatrix)}for(this._options.verboseMessages&&this._log("Skin contains "+r.length+" bones",E.messageInfo),l=0;l<r.length;){for(n=r[l],l+=1,v=0,w=r.length;v<w;v++)if(p=r[v],n.node.parent===p.node){n.parent=p;break}null!=n.node.parent&&n.node.parent instanceof O&&null==n.parent&&(n.parent=this._createBone(n.node.parent,"",r))}if(this._options.verboseMessages&&this._log("Skeleton contains "+r.length+" bones",E.messageInfo),null==s.vertexWeights)return this._log("Skin has no vertex weight data, mesh ignored",E.messageError),null;if(s.vertexWeights.joints.source.url!==s.joints.joints.source.url)return this._log("Skin uses different data sources for joints in <joints> and <vertex_weights>, this is not supported by this loader, mesh ignored",E.messageError),null;if(R=this._createGeometryAndMaterial(o,e.materials),g=R[0],_=R[1],this._options.convertSkinsToMorphs)return this._addSkinMorphTargets(g,s,r,_)?new THREE.MorphAnimMesh(g,_):new THREE.Mesh(g,_);if(this._addSkinBones(g,s,r,_)){for(c=new THREE.SkinnedMesh(g,_),c.boneInverses=[],j=g.bones,k=0,C=j.length;k<C;k++)n=j[k],c.boneInverses.push(n.inverse);return c}return new THREE.Mesh(g,_)},p.prototype._findJointNode=function(e,t){var n,r,i,a;for(n=null,i=0,a=t.length;i<a&&(r=t[i],null==(n=this._findSidTarget(r,e)));i++);return n instanceof O?n:null},p.prototype._createBone=function(e,t,n){var r,i,a,s,o;for(r=new q,r.sid=t,r.node=e,o=e.transformations,a=0,s=o.length;a<s;a++)if(i=o[a],i.animTarget.channels.length>0){r.isAnimated=!0;break}return r.matrix=new THREE.Matrix4,e.getTransformMatrix(r.matrix),r.index=n.length,n.push(r),r},p.prototype._addSkinMorphTargets=function(e,t,n,r){var i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,C,A,N,M,S,I,L,U,R,j,H;if(!(g=this._prepareAnimations(n))>0)return null;if(f=e.vertices,f.length,T=t.vertexWeights.v,x=t.vertexWeights.vcount,k=this._getLinkTarget(t.vertexWeights.joints.source),C=this._getLinkTarget(t.vertexWeights.weights.source),null!=k?k.data:void 0,null==(w=null!=C?C.data:void 0))return this._log("Skin has no weights data, no morph targets added for mesh",E.messageError),null;for(i=new THREE.Matrix4,null!=t.bindShapeMatrix&&(i=z(t.bindShapeMatrix,0)),m=new THREE.Vector3,u=!0,h=!0,c=0,R=g-1;c<=R;c+=1){for(this._updateSkinMatrices(n,i,c),b=[],M=0,I=f.length;M<I;M++)f[M],b.push(new THREE.Vector3);for(v=0,c=0,L=b.length;c<L;c++){for(y=b[c],d=f[c],N=x[c],_=0,A=0,j=N-1;A<=j;A+=1)s=T[v],l=T[v+1],v+=2,o=w[l],_+=o,s>=0?(a=n[s],m.copy(d),m.applyMatrix4(a.skinMatrix),m.multiplyScalar(o),y.add(m)):(m.copy(d),m.applyMatrix4(i),m.multiplyScalar(o),y.add(m));0===N?(y.copy(d),u&&(this._log("Skinned vertex not influenced by any bone, some vertices will be unskinned",E.messageWarning),u=!1)):.01<_&&_<1e6?y.multiplyScalar(1/_):(y.copy(d),h&&(this._log("Zero or infinite total weight for skinned vertex, some vertices will be unskinned",E.messageWarning),h=!1))}v!==T.length&&this._log("Skinning did not consume all weights",E.messageError),e.morphTargets.push({name:"target",vertices:b})}if(e.computeMorphNormals(),r.morphTargets=!0,r.morphNormals=!0,null!=r.materials)for(H=r.materials,S=0,U=H.length;S<U;S++)p=H[S],p.morphTargets=!0,p.morphNormals=!0;return!0},p.prototype._prepareAnimations=function(e){var t,n,r,i,a,s,o,l,h,u,c,p,d,f;for(a=null,o=0,u=e.length;o<u;o++){for(t=e[o],i=!1,d=t.node.transformations,l=0,c=d.length;l<c;l++)for(s=d[l],s.resetAnimation(),s.selectAllAnimations(),f=s.animTarget.activeChannels,h=0,p=f.length;h<p;h++){if(n=f[h],i=!0,r=n.inputData.length,null!=a&&r!==a)return this._log("Inconsistent number of time steps, no morph targets added for mesh. Resample all animations to fix this.",E.messageError),null;a=r}this._options.verboseMessages&&!i&&this._log("Joint '"+t.sid+"' has no animation channel",E.messageWarning)}return a},p.prototype._updateSkinMatrices=function(e,t,n){var r,i,a,s,o;for(i=0,s=e.length;i<s;i++)r=e[i],r.applyAnimation(n);for(a=0,o=e.length;a<o;a++)r=e[a],r.updateSkinMatrix(t);return null},p.prototype._addSkinBones=function(e,t,n,r){var i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,C,A,N,M,S,I,L,U,R,j,H,O,D,V,W,q,G,F,P,B,X,J,K,Q,Y;if(!(N=this._prepareAnimations(n))>0)return null;if(v=e.vertices,v.length,L=t.vertexWeights.v,U=t.vertexWeights.vcount,I=this._getLinkTarget(t.vertexWeights.joints.source),j=this._getLinkTarget(t.vertexWeights.weights.source),null!=I?I.data:void 0,null==(R=null!=j?j.data:void 0))return this._log("Skin has no weights data, no skin added for mesh",E.messageError),null;for(i=new THREE.Matrix4,null!=t.bindShapeMatrix&&(i=z(t.bindShapeMatrix,0)),_=new THREE.Vector3,y=new THREE.Quaternion,b=new THREE.Vector3,c=!0,u=!0,C=[],A=[],S=0,h=4,d=[0,0,0,0],D=[0,0,0,0],p=0,G=v.length;p<G;p++){for(v[p],O=U[p],O>h&&(c&&(this._log("Too many bones influence a vertex, some influences will be discarded. Threejs supports only "+h+" bones per vertex.",E.messageWarning),c=!1),O=h),M=0,H=0,X=O-1;H<=X;H+=1)s=L[S],l=L[S+1],S+=2,o=R[l],M+=o,d[H]=s,D[H]=o;for(H=D,J=h-1;H<=J;H+=1)d[H]=0,D[H]=0;if(.01<M&&M<1e6)for(H=0,K=h-1;H<=K;H+=1)D[H]/=M;else u&&(this._log("Zero or infinite total weight for skinned vertex, skin will be broken",E.messageWarning),u=!1);C.push(new THREE.Vector4(d[0],d[1],d[2],d[3])),A.push(new THREE.Vector4(D[0],D[1],D[2],D[3]))}for(e.skinIndices=C,e.skinWeights=A,w=[],V=0,F=n.length;V<F;V++)a=n[V],T={},null!=a.parent?T.parent=a.parent.index:T.parent=-1,T.name=a.node.name,a.matrix.decompose(_,y,b),T.pos=[_.x,_.y,_.z],T.scl=[b.x,b.y,b.z],T.rotq=[y.x,y.y,y.z,y.w],T.rot=null,T.inverse=new THREE.Matrix4,T.inverse.multiplyMatrices(a.invBindMatrix,i),w.push(T);for(e.bones=w,k={},k.name="animation",k.hierarchy=[],W=0,P=n.length;W<P;W++){for(a=n[W],x={},x.parent=a.index,x.keys=[],m=0,Q=N-1;m<=Q;m+=1)a.applyAnimation(m),a.updateSkinMatrix(i),f={},f.time=m,a.matrix.decompose(_,y,b),f.pos=[_.x,_.y,_.z],f.scl=[b.x,b.y,b.z],f.rot=[y.x,y.y,y.z,y.w],x.keys.push(f);k.hierarchy.push(x)}if(k.fps=30,k.length=N-1,e.animation=k,r.skinning=!0,null!=r.materials)for(Y=r.materials,q=0,B=Y.length;q<B;q++)g=Y[q],g.skinning=!0;return!0},p.prototype._createMorphMesh=function(e,t){return this._log("Morph animated meshes not supported, mesh ignored",E.messageError),null},p.prototype._createGeometry=function(e,t){var n,r,i,a,s,o;for(r=new THREE.Geometry,o=e.triangles,a=0,s=o.length;a<s;a++)i=o[a],n=t.indices[i.material],null==n&&(this._log("Material symbol "+i.material+" has no bound material instance",E.messageError),n=0),this._addTrianglesToGeometry(e,i,n,r);return r.computeFaceNormals(),r.computeCentroids(),t.needtangents&&r.computeTangents(),r.computeBoundingBox(),r},p.prototype._addTrianglesToGeometry=function(e,t,n,r){var i,a,s,o,l,h,u,c,p,d,f,m,g,_,y,b,v,k,T,x,w,C,A,N,M,S,L,U,R,H,O,D,V,W,q,G,F,P,B,X,z,J,K,Q,Y,Z,$,ee,te,ne,re,ie,ae,se,oe,le,he,ue,ce,pe,de,fe,me,ge,_e,ye,be,ve=this;for(w=null,T=null,k=null,x=[],me=t.inputs,ae=0,le=me.length;ae<le;ae++)switch(v=me[ae],v.semantic){case"VERTEX":w=v;break;case"NORMAL":T=v;break;case"COLOR":k=v;break;case"TEXCOORD":x.push(v);break;default:this._log("Unknown triangles input semantic "+v.semantic+" ignored",E.messageWarning)}if(null==(F=this._getLinkTarget(w.source,j)))return void this._log("Geometry "+e.id+" has no vertices",E.messageError);for(q=this._getLinkTarget(null!=T?T.source:void 0,I),W=this._getLinkTarget(null!=k?k.source:void 0,I),G=x.map(function(e){return ve._getLinkTarget(null!=e?e.source:void 0,I)}),N=null,A=null,C=null,M=[],ge=F.inputs,se=0,he=ge.length;se<he;se++)switch(v=ge[se],v.semantic){case"POSITION":N=v;break;case"NORMAL":A=v;break;case"COLOR":C=v;break;case"TEXCOORD":M.push(v);break;default:this._log("Unknown vertices input semantic "+v.semantic+" ignored",E.messageWarning)}if(null==(X=this._getLinkTarget(N.source,I)))return void this._log("Geometry "+e.id+" has no vertex positions",E.messageError);for(B=this._getLinkTarget(null!=A?A.source:void 0,I),P=this._getLinkTarget(null!=C?C.source:void 0,I),z=M.map(function(e){return ve._getLinkTarget(null!=e?e.source:void 0,I)}),f=this._createVector3Array(X),d=this._createVector3Array(B),u=this._createVector3Array(q),p=this._createColorArray(P),h=this._createColorArray(W),m=z.map(function(e){return ve._createUVArray(e)}),c=G.map(function(e){return ve._createUVArray(e)}),r.vertices=f,V=m.length+c.length,r.faceVertexUvs.length,D=t.count,O=r.faces.count,_e=r.faceVertexUvs,y=0,ue=_e.length;y<ue;y++)_=_e[y],y<V?(S=_.length-r.faces.length,this._addEmptyUVs(_,S)):(S=_.length-r.faces.length+D,this._addEmptyUVs(_,S));for(;r.faceVertexUvs.length<V;)_=[],this._addEmptyUVs(_,O),r.faceVertexUvs.push(_);if("triangles"!==t.type)for(re=t.vcount,oe=0,ce=re.length;oe<ce;oe++)if(3!==re[oe])return void this._log("Geometry "+e.id+" has non-triangle polygons, geometry ignored",E.messageError);for(b=t.indices,$=b.length/t.count,ie=$/3,ye=t.indices,Z=0,pe=ye.length,be=$;Z<pe;Z+=be){for(ye[Z],i=Z+0*ie,a=Z+1*ie,s=Z+2*ie,ee=b[i+w.offset],te=b[a+w.offset],ne=b[s+w.offset],null!=d?H=[d[ee],d[te],d[ne]]:null!=u?(L=b[i+T.offset],U=b[a+T.offset],R=b[s+T.offset],H=[u[L],u[U],u[R]]):H=null,null!=p?o=[p[ee],p[te],p[ne]]:null!=h?(L=b[i+k.offset],U=b[a+k.offset],R=b[s+k.offset],o=[h[L],h[U],h[R]]):o=null,g=new THREE.Face3(ee,te,ne,H,o),null!=n&&(g.materialIndex=n),r.faces.push(g),y=0,de=m.length;y<de;y++)l=m[y],null==l?geometry.faceVertexUvs[y].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)]):(Y=[l[ee],l[te],l[ne]],geometry.faceVertexUvs[y].push(Y));for(y=0,fe=c.length;y<fe;y++)l=c[y],null==l?geometry.faceVertexUvs[y].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)]):(J=b[i+x[y].offset],K=b[a+x[y].offset],Q=b[s+x[y].offset],Y=[l[J],l[K],l[Q]],r.faceVertexUvs[y].push(Y))}},p.prototype._addEmptyUVs=function(e,t){var n,r;for(n=0,r=t-1;n<=r;n+=1)e.push(new THREE.Vector2(0,0))},p.prototype._createVector3Array=function(e){var t,n,r,i;if(null==e)return null;if(3!==e.stride)return this._log("Vector source data does not contain 3D vectors",E.messageError),null;for(t=[],r=e.data,n=0,i=r.length-1;n<=i;n+=3)t.push(new THREE.Vector3(r[n],r[n+1],r[n+2]));return t},p.prototype._createColorArray=function(e){var t,n,r,i,a;if(null==e)return null;if(e.stride<3)return this._log("Color source data does not contain 3+D vectors",E.messageError),null;for(t=[],r=e.data,n=0,i=r.length-1,a=e.stride;0<=i?n<=i:n>=i;n+=a)t.push((new THREE.Color).setRGB(r[n],r[n+1],r[n+2]));return t},p.prototype._createUVArray=function(e){var t,n,r,i,a;if(null==e)return null;if(e.stride<2)return this._log("UV source data does not contain 2+D vectors",E.messageError),null;for(t=[],r=e.data,n=0,i=r.length-1,a=e.stride;0<=i?n<=i:n>=i;n+=a)t.push(new THREE.Vector2(r[n],1-r[n+1]));return t},p.prototype._createMaterials=function(e){var t,n,r,i,a,s,o;for(r=new W,n=0,s=0,o=e.length;s<o;s++)t=e[s],i=t.symbol,null!=i?null==r.indices[i]?(a=this._createMaterial(t),null==a.bumpMap&&null==a.normalMap||(r.needtangents=!0),this.threejs.materials.push(a),r.materials.push(a),r.indices[i]=n++):this._log("Geometry instance tried to map material symbol "+i+" multiple times",E.messageError):this._log("Material instance has no symbol, material skipped.",E.messageError);return r},p.prototype._createMaterial=function(e){var t,n;return null==(n=this._getLinkTarget(e.material,C))?this._createDefaultMaterial:(t=this._getLinkTarget(n.effect,l),null==t?this._createDefaultMaterial:this._createBuiltInMaterial(t))},p.prototype._createShaderMaterial=function(e){var t,n,r,i,a,s,o,l,h,u;return n=e.technique,t=THREE.ShaderUtils.lib.normal,o=THREE.UniformsUtils.clone(t.uniforms),a=this._loadThreejsTexture(n.bump),null!=a&&(o.tNormal.texture=a,o.uNormalScale.value=.85),r=this._loadThreejsTexture(n.diffuse),null!=r?(o.tDiffuse.texture=r,o.enableDiffuse.value=!0):o.enableDiffuse.value=!1,s=this._loadThreejsTexture(n.specular),null!=s?(o.tSpecular.texture=s,o.enableSpecular.value=!0):o.enableSpecular.value=!1,i=this._loadThreejsTexture(n.emission),null!=i?(o.tAO.texture=i,o.enableAO.value=!0):o.enableAO.value=!1,null!=(null!=(l=n.diffuse)?l.color:void 0)&&o.uDiffuseColor.value.setHex(B(n.diffuse.color)),
null!=(null!=(h=n.specular)?h.color:void 0)&&o.uSpecularColor.value.setHex(B(n.specular.color)),null!=(null!=(u=n.ambient)?u.color:void 0)&&o.uAmbientColor.value.setHex(B(n.ambient.color)),null!=n.shininess&&(o.uShininess.value=n.shininess),null!=n.transparency&&(o.uOpacity.value=this._getOpacity(e)),new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:o,lights:!0})},p.prototype._getOpacity=function(e){var t,n,r,i,a,s;return n=e.technique,i=n.transparent,t=null!=i?i.opaque:void 0,null!=t&&"A_ONE"!==t&&this._log("Opacity mode "+t+" not supported, transparency will be broken",E.messageWarning),null!=(null!=i?i.textureSampler:void 0)&&this._log("Separate transparency texture not supported, transparency will be broken",E.messageWarning),a=(null!=i&&null!=(s=i.color)?s[3]:void 0)||1,r=n.transparency||1,a*r},p.prototype._hasTransparency=function(e){var t,n,r;return t=e.technique,null!=(null!=(n=t.transparent)?n.textureSampler:void 0)||0>=(r=t.transparency)&&r>=1},p.prototype._createBuiltInMaterial=function(e){var t,n,r,i;switch(i=e.technique,r={},this._setThreejsMaterialParam(r,i.diffuse,"diffuse","map",!1),this._setThreejsMaterialParam(r,i.emission,"emissive",null,!1),this._setThreejsMaterialParam(r,i.ambient,"ambient","lightMap",!1),this._setThreejsMaterialParam(r,i.specular,"specular","specularMap",!1),this._setThreejsMaterialParam(r,i.bump,null,"normalMap",!1),r.bumpMap&&(r.bumpScale=1),r.normalMap&&(r.normalScale=new THREE.Vector2(1,1)),null!=r.map&&(r.diffuse=16777215),null!=r.specularMap&&(r.specular=16777215),null==r.diffuse&&(r.diffuse=16777215),null!=i.shininess&&(r.shininess=i.shininess),null!=i.reflectivity&&(r.reflectivity=i.reflectivity),t=this._hasTransparency(e),t&&(r.transparent=!0,n=this._getOpacity(e),r.opacity=n,r.alphaTest=.001),i.doubleSided&&(r.side=THREE.DoubleSide),r.shading=THREE.SmoothShading,r.perPixel=!0,i.shading){case"blinn":case"phong":return r.color=r.diffuse,new THREE.MeshPhongMaterial(r);case"lambert":return r.color=r.diffuse,new THREE.MeshLambertMaterial(r);case"constant":return r.color=r.emission,new THREE.MeshBasicMaterial(r);default:return this._createDefaultMaterial}},p.prototype._createDefaultMaterial=function(){return new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading})},p.prototype._setThreejsMaterialParam=function(e,t,n,r,i){var a;if(null!=t)if(null!=t.color&&null!=n){if(!i&&null!=e[n])return;e[n]=B(t.color)}else if(null!=t.textureSampler&&null!=r){if(!i&&null!=e[r])return;a=this._loadThreejsTexture(t),null!=a&&(e[r]=a)}},p.prototype._loadThreejsTexture=function(e){var t,n,r,i;return null==e.textureSampler?null:null==(r=this._getLinkTarget(e.textureSampler,h))?null:(n=null,null!=r.image?n=this._getLinkTarget(r.image,m):null!=r.surface&&(i=this._getLinkTarget(r.surface,u),n=this._getLinkTarget(i.initFrom,m)),null==n?null:(t=this._baseUrl+n.initFrom,this._loader._loadTextureFromURL(t)))},p}(),E=function(){function e(){this.log=e.logConsole,this._imageCache={},this.options={useAnimations:!0,convertSkinsToMorphs:!1,verboseMessages:!1,localImageMode:!1}}return e.messageTrace=0,e.messageInfo=1,e.messageWarning=2,e.messageError=3,e.messageTypes=["TRACE","INFO","WARNING","ERROR"],e.logConsole=function(t,n){console.log("ColladaLoader2 "+e.messageTypes[n]+": "+t)},e.prototype.setLog=function(e){this.log=e||this.logConsole},e.prototype.addChachedTextures=function(e){var t,n;for(t in e)n=e[t],this._imageCache[t]=n},e.prototype.load=function(t,n,r){var i,a,s,o=this;i=0,(null!=(s=document.implementation)?s.createDocument:void 0)?(a=new XMLHttpRequest,"function"==typeof a.overrideMimeType&&a.overrideMimeType("text/xml"),a.onreadystatechange=function(){if(4===a.readyState){if(0===a.status||200===a.status)return a.responseXML?o.parse(a.responseXML,n,t):o.log("Empty or non-existing file "+t+".",e.messageError)}else if(3===a.readyState&&r)return 0===i&&(i=a.getResponseHeader("Content-Length")),r({total:i,loaded:a.responseText.length})},a.open("GET",t,!0),a.send(null)):this.log("Don't know how to parse XML!",e.messageError)},e.prototype.parse=function(e,t,n){var r;return r=new p(this),r.setUrl(n),r._readyCallback=t,r._parseXml(e),r._linkAnimations(),r._createSceneGraph(),r._readyCallback&&r._readyCallback(r),r},e.prototype._loadTextureFromURL=function(t){var n;return null!=(n=this._imageCache[t])?n:(this.options.localImageMode&&(n=this._loadImageLocal(t)),null==n&&(n=this._loadImageSimple(t)),null!=n?this._imageCache[t]=n:this.log("Texture "+t+" could not be loaded, texture will be ignored.",e.messageError),n)},e.prototype._loadImageThreejs=function(e){var t;return t=THREE.ImageUtils.loadTexture(e),t.flipY=!1,t},e.prototype._loadImageSimple=function(e){var t,n;return t=new Image,n=new THREE.Texture(t),n.flipY=!1,n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping,t.onload=function(){return n.needsUpdate=!0},t.crossOrigin="anonymous",t.src=e,n},e.prototype._loadImageLocal=function(e){var t,n,r,i,a,s,o;n=this._removeSameDirectoryPath(e),s=this._imageCache;for(r in s)if(a=s[r],t=this._removeSameDirectoryPath(r),n.indexOf(t)>=0){i=a;break}if(n=this._removeSameDirectoryPath(this._removeFileExtension(e)),null==i){o=this._imageCache;for(r in o)if(a=o[r],t=this._removeSameDirectoryPath(this._removeFileExtension(r)),n.indexOf(t)>=0){i=a;break}}return i},e.prototype._removeFileExtension=function(e){return e.substr(0,e.lastIndexOf("."))||e},e.prototype._removeSameDirectoryPath=function(e){return e.replace(/^.\//,"")},e}(),Z=function(e){var t;return e.length>0?(t=e.trim(),t.split(/\s+/)):[]},Q=function(e){var t,n,r,i,a;for(i=Z(e),t=new Float32Array(i.length),n=0,a=i.length;n<a;n++)r=i[n],t[n]=parseFloat(r);return t},Y=function(e){var t,n,r,i,a;for(i=Z(e),t=new Int32Array(i.length),n=0,a=i.length;n<a;n++)r=i[n],t[n]=parseInt(r,10);return t},J=function(e){var t,n,r,i,a,s;for(i=Z(e),t=new Uint8Array(i.length),n=0,a=i.length;n<a;n++)r=i[n],t[n]=null!=(s="true"===r||"1"===r)?s:{1:0};return t},K=function(e){var t;return t=Q(e),4===t.length?t:null},B=function(e){return null!=e?Math.floor(255*e[0])<<16^Math.floor(255*e[1])<<8^Math.floor(255*e[2]):null},z=function(e,t){return new THREE.Matrix4(e[0+t],e[1+t],e[2+t],e[3+t],e[4+t],e[5+t],e[6+t],e[7+t],e[8+t],e[9+t],e[10+t],e[11+t],e[12+t],e[13+t],e[14+t],e[15+t])},X=function(e,t,n){return n.set(e[0+t],e[1+t],e[2+t],e[3+t],e[4+t],e[5+t],e[6+t],e[7+t],e[8+t],e[9+t],e[10+t],e[11+t],e[12+t],e[13+t],e[14+t],e[15+t])},D=Math.PI/180,E.prototype.setLog=E.prototype.setLog,E.prototype.addChachedTextures=E.prototype.addChachedTextures,E.prototype.load=E.prototype.load,E.prototype.parse=E.prototype.parse,"undefined"!=typeof module&&null!==module?module.exports=E:"undefined"!=typeof window&&null!==window&&(window.ColladaLoader2=E)}).call(this);